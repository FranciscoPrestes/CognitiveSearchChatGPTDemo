import{n as P,K as ve,c as Ge,d as Qe}from"./keyborg-072ac2b1.js";/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */const N="data-tabster",Re="data-tabster-dummy",Ce="tabster:deloser",Me="tabster:modalizer:active",Oe="tabster:modalizer:inactive",Je="tabster:modalizer:focusin",Xe="tabster:modalizer:focusout",ke="tabster:modalizer:beforefocusout",re="tabster:mover",xe="tabster:focusin",Ae="tabster:focusout",qe={Any:0,Accessible:1,Focusable:2},S={History:0,DeloserDefault:1,RootDefault:2,DeloserFirst:3,RootFirst:4},z={Invisible:0,PartiallyVisible:1,Visible:2},B={Both:0,Vertical:1,Horizontal:2,Grid:3},$e={Unlimited:0,Limited:1,LimitedTrapFocus:2},ze={Auto:0,Inside:1,Outside:2};var Wt=Object.freeze({__proto__:null,TabsterAttributeName:N,TabsterDummyInputAttributeName:Re,DeloserEventName:Ce,ModalizerActiveEventName:Me,ModalizerInactiveEventName:Oe,ModalizerFocusInEventName:Je,ModalizerFocusOutEventName:Xe,ModalizerBeforeFocusOutEventName:ke,MoverEventName:re,FocusInEventName:xe,FocusOutEventName:Ae,ObservedElementAccesibilities:qe,RestoreFocusOrders:S,Visibilities:z,MoverDirections:B,GroupperTabbabilities:$e,SysDummyInputsPositions:ze});/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */function k(l,e){var t;return(t=l.storageEntry(e))===null||t===void 0?void 0:t.tabster}function Ne(l,e,t){var i,s;const o=t||l._noop?void 0:e.getAttribute(N);let n=l.storageEntry(e),a;if(o)if(o!==((i=n==null?void 0:n.attr)===null||i===void 0?void 0:i.string))try{const f=JSON.parse(o);if(typeof f!="object")throw new Error(`Value is not a JSON object, got '${o}'.`);a={string:o,object:f}}catch{}else return;else if(!n)return;n||(n=l.storageEntry(e,!0)),n.tabster||(n.tabster={});const r=n.tabster||{},c=((s=n.attr)===null||s===void 0?void 0:s.object)||{},u=(a==null?void 0:a.object)||{};for(const f of Object.keys(c))if(!u[f]){if(f==="root"){const b=r[f];b&&l.root.onRoot(b,!0)}switch(f){case"deloser":case"root":case"groupper":case"modalizer":case"mover":const b=r[f];b&&(b.dispose(),delete r[f]);break;case"observed":delete r[f],l.observedElement&&l.observedElement.onObservedElementUpdate(e);break;case"focusable":case"outline":case"uncontrolled":case"sys":delete r[f];break}}for(const f of Object.keys(u)){const b=u.sys;switch(f){case"deloser":r.deloser?r.deloser.setProps(u.deloser):l.deloser&&(r.deloser=l.deloser.createDeloser(e,u.deloser));break;case"root":r.root?r.root.setProps(u.root):r.root=l.root.createRoot(e,u.root,b),l.root.onRoot(r.root);break;case"modalizer":r.modalizer?r.modalizer.setProps(u.modalizer):l.modalizer&&(r.modalizer=l.modalizer.createModalizer(e,u.modalizer,b));break;case"focusable":r.focusable=u.focusable;break;case"groupper":r.groupper?r.groupper.setProps(u.groupper):l.groupper&&(r.groupper=l.groupper.createGroupper(e,u.groupper,b));break;case"mover":r.mover?r.mover.setProps(u.mover):l.mover&&(r.mover=l.mover.createMover(e,u.mover,b));break;case"observed":l.observedElement&&(r.observed=u.observed,l.observedElement.onObservedElementUpdate(e));break;case"uncontrolled":r.uncontrolled=u.uncontrolled;break;case"outline":l.outline&&(r.outline=u.outline);break;case"sys":r.sys=u.sys;break;default:console.error(`Unknown key '${f}' in data-tabster attribute value.`)}}a?n.attr=a:(Object.keys(r).length===0&&(delete n.tabster,delete n.attr),l.storageEntry(e,!1))}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */function Ye(l){const e=l();try{if(e.EventTarget)return new e.EventTarget}catch(t){if(!(t instanceof TypeError))throw t}return e.document.createElement("div")}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */let ae;const be=typeof DOMRect<"u"?DOMRect:class{constructor(l,e,t,i){this.left=l||0,this.top=e||0,this.right=(l||0)+(t||0),this.bottom=(e||0)+(i||0)}};let Ze=0;try{document.createTreeWalker(document,NodeFilter.SHOW_ELEMENT),ae=!1}catch{ae=!0}const ie=100;function W(l){const e=l();let t=e.__tabsterInstanceContext;return t||(t={elementByUId:{},basics:{Promise:e.Promise||void 0,WeakRef:e.WeakRef||void 0},containerBoundingRectCache:{},lastContainerBoundingRectCacheId:0,fakeWeakRefs:[],fakeWeakRefsStarted:!1},e.__tabsterInstanceContext=t),t}function et(l){const e=l.__tabsterInstanceContext;e&&(e.elementByUId={},delete e.WeakRef,e.containerBoundingRectCache={},e.containerBoundingRectCacheTimer&&l.clearTimeout(e.containerBoundingRectCacheTimer),e.fakeWeakRefsTimer&&l.clearTimeout(e.fakeWeakRefsTimer),e.fakeWeakRefs=[],delete l.__tabsterInstanceContext)}function tt(l){const e=l.__tabsterInstanceContext;return new((e==null?void 0:e.basics.WeakMap)||WeakMap)}class Pe{constructor(e){this._target=e}deref(){return this._target}static cleanup(e,t){return e._target?t||!Q(e._target.ownerDocument,e._target)?(delete e._target,!0):!1:!0}}class L{constructor(e,t,i){const s=W(e);let o;s.WeakRef?o=new s.WeakRef(t):(o=new Pe(t),s.fakeWeakRefs.push(o)),this._ref=o,this._data=i}get(){const e=this._ref;let t;return e&&(t=e.deref(),t||delete this._ref),t}getData(){return this._data}}function We(l,e){const t=W(l);t.fakeWeakRefs=t.fakeWeakRefs.filter(i=>!Pe.cleanup(i,e))}function Le(l){const e=W(l);e.fakeWeakRefsStarted||(e.fakeWeakRefsStarted=!0,e.WeakRef=nt(e)),e.fakeWeakRefsTimer||(e.fakeWeakRefsTimer=l().setTimeout(()=>{e.fakeWeakRefsTimer=void 0,We(l),Le(l)},2*60*1e3))}function it(l){const e=W(l);e.fakeWeakRefsStarted=!1,e.fakeWeakRefsTimer&&(l().clearTimeout(e.fakeWeakRefsTimer),e.fakeWeakRefsTimer=void 0,e.fakeWeakRefs=[])}function ce(l,e,t){if(e.nodeType!==Node.ELEMENT_NODE)return;const i=ae?t:{acceptNode:t};return l.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,i,!1)}function Ue(l,e){let t=e.__tabsterCacheId;const i=W(l),s=t?i.containerBoundingRectCache[t]:void 0;if(s)return s.rect;const o=e.ownerDocument&&e.ownerDocument.documentElement;if(!o)return new be;let n=0,a=0,r=o.clientWidth,c=o.clientHeight;if(e!==o){const f=e.getBoundingClientRect();n=Math.max(n,f.left),a=Math.max(a,f.top),r=Math.min(r,f.right),c=Math.min(c,f.bottom)}const u=new be(n<r?n:-1,a<c?a:-1,n<r?r-n:0,a<c?c-a:0);return t||(t="r-"+ ++i.lastContainerBoundingRectCacheId,e.__tabsterCacheId=t),i.containerBoundingRectCache[t]={rect:u,element:e},i.containerBoundingRectCacheTimer||(i.containerBoundingRectCacheTimer=window.setTimeout(()=>{i.containerBoundingRectCacheTimer=void 0;for(const f of Object.keys(i.containerBoundingRectCache))delete i.containerBoundingRectCache[f].element.__tabsterCacheId;i.containerBoundingRectCache={}},50)),u}function pe(l,e,t){const i=Se(e);if(!i)return!1;const s=Ue(l,i),o=e.getBoundingClientRect(),n=o.height*(1-t),a=Math.max(0,s.top-o.top),r=Math.max(0,o.bottom-s.bottom),c=a+r;return c===0||c<=n}function ge(l,e,t){const i=Se(e);if(i){const s=Ue(l,i),o=e.getBoundingClientRect();t?i.scrollTop+=o.top-s.top:i.scrollTop+=o.bottom-s.bottom}}function Se(l){const e=l.ownerDocument;if(e){for(let t=l.parentElement;t;t=t.parentElement)if(t.scrollWidth>t.clientWidth||t.scrollHeight>t.clientHeight)return t;return e.documentElement}return null}function st(l){l.__shouldIgnoreFocus=!0}function Be(l){return!!l.__shouldIgnoreFocus}function ot(l){const e=new Uint32Array(4);if(l.crypto&&l.crypto.getRandomValues)l.crypto.getRandomValues(e);else if(l.msCrypto&&l.msCrypto.getRandomValues)l.msCrypto.getRandomValues(e);else for(let i=0;i<e.length;i++)e[i]=4294967295*Math.random();const t=[];for(let i=0;i<e.length;i++)t.push(e[i].toString(36));return t.push("|"),t.push((++Ze).toString(36)),t.push("|"),t.push(Date.now().toString(36)),t.join("")}function K(l,e){const t=W(l);let i=e.__tabsterElementUID;return i||(i=e.__tabsterElementUID=ot(l())),!t.elementByUId[i]&&Q(e.ownerDocument,e)&&(t.elementByUId[i]=new L(l,e)),i}function Ee(l,e){const t=W(l);for(const i of Object.keys(t.elementByUId)){const s=t.elementByUId[i],o=s&&s.get();o&&e&&!e.contains(o)||delete t.elementByUId[i]}}function Q(l,e){var t;return!!(!((t=l==null?void 0:l.body)===null||t===void 0)&&t.contains(e))}function Ve(l,e){const t=l.matches||l.matchesSelector||l.msMatchesSelector||l.webkitMatchesSelector;return t&&t.call(l,e)}function Ke(l){const e=W(l);if(e.basics.Promise)return e.basics.Promise;throw new Error("No Promise defined.")}function nt(l){return l.basics.WeakRef}let rt=0;class J{constructor(e,t,i){const s=e.getWindow;this._tabster=e,this._element=new L(s,t),this._props={...i},this.id="i"+ ++rt}getElement(){return this._element.get()}getProps(){return this._props}setProps(e){this._props={...e}}}class le{constructor(e,t,i,s){var o;this._focusIn=c=>{const u=this.input;if(this.onFocusIn&&u){const f=A.getLastPhantomFrom()||c.relatedTarget;this.onFocusIn(this,this._isBackward(!0,u,f),f)}},this._focusOut=c=>{this.useDefaultAction=!1;const u=this.input;if(this.onFocusOut&&u){const f=c.relatedTarget;this.onFocusOut(this,this._isBackward(!1,u,f),f)}};const n=e(),a=n.document.createElement("i");a.tabIndex=0,a.setAttribute("role","none"),a.setAttribute(Re,""),a.setAttribute("aria-hidden","true");const r=a.style;r.position="fixed",r.width=r.height="1px",r.opacity="0.001",r.zIndex="-1",r.setProperty("content-visibility","hidden"),st(a),this.input=a,this.isFirst=i.isFirst,this.isOutside=t,this._isPhantom=(o=i.isPhantom)!==null&&o!==void 0?o:!1,a.addEventListener("focusin",this._focusIn),a.addEventListener("focusout",this._focusOut),a.__tabsterDummyContainer=s,this._isPhantom&&(this._disposeTimer=n.setTimeout(()=>{delete this._disposeTimer,this.dispose()},0),this._clearDisposeTimeout=()=>{this._disposeTimer&&(n.clearTimeout(this._disposeTimer),delete this._disposeTimer),delete this._clearDisposeTimeout})}dispose(){var e;this._clearDisposeTimeout&&this._clearDisposeTimeout();const t=this.input;t&&(delete this.onFocusIn,delete this.onFocusOut,delete this.input,t.removeEventListener("focusin",this._focusIn),t.removeEventListener("focusout",this._focusOut),delete t.__tabsterDummyContainer,(e=t.parentElement)===null||e===void 0||e.removeChild(t))}setTopLeft(e,t){var i;const s=(i=this.input)===null||i===void 0?void 0:i.style;s&&(s.top=`${e}px`,s.left=`${t}px`)}_isBackward(e,t,i){return e&&!i?!this.isFirst:!!(i&&t.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_FOLLOWING)}}const de={Root:1,Modalizer:2,Mover:3,Groupper:4};class A{constructor(e,t,i,s,o,n){this._element=t,this._instance=new lt(e,t,this,i,s,o,n),this.moveOut=a=>{var r;(r=this._instance)===null||r===void 0||r.moveOut(a)},this.moveOutWithDefaultAction=a=>{var r;(r=this._instance)===null||r===void 0||r.moveOutWithDefaultAction(a)}}_setHandlers(e,t){this._onFocusIn=e,this._onFocusOut=t}getHandler(e){return e?this._onFocusIn:this._onFocusOut}setTabbable(e){var t;(t=this._instance)===null||t===void 0||t.setTabbable(this,e)}dispose(){this._instance&&(this._instance.dispose(this),delete this._instance),delete this._onFocusIn,delete this._onFocusOut}static getLastPhantomFrom(){const e=A._lastPhantomFrom;return delete A._lastPhantomFrom,e}static moveWithPhantomDummy(e,t,i,s){const n=new le(e.getWindow,!0,{isPhantom:!0,isFirst:!0}).input;if(n){const a=t.parentElement;if(a){let r=i&&!s||!i&&s?t.nextElementSibling:t;if(r)if(s){const c=r.previousElementSibling;c&&c.__tabsterDummyContainer&&(r=c)}else r.__tabsterDummyContainer&&(r=r.nextElementSibling);a.insertBefore(n,r),A._lastPhantomFrom=t,e.getWindow().setTimeout(()=>{delete A._lastPhantomFrom},0),P(n)}}}}class at{constructor(e){this._updateQueue=new Set,this._lastUpdateQueueTime=0,this._changedParents=new WeakSet,this._dummies=new Map,this._domChanged=t=>{var i;this._changedParents.has(t)||(this._changedParents.add(t),!this._updateDummyInputsTimer&&(this._updateDummyInputsTimer=(i=this._win)===null||i===void 0?void 0:i.call(this).setTimeout(()=>{delete this._updateDummyInputsTimer;for(const[s,o]of this._dummies){const n=s.parentElement;(!n||this._changedParents.has(n))&&o()}this._changedParents=new WeakSet},ie)))},this._win=e}add(e,t){this._dummies.set(e,t),this.domChanged=this._domChanged}remove(e){const t=this._dummies;t.delete(e),t.size===0&&delete this.domChanged}dispose(){var e;const t=(e=this._win)===null||e===void 0?void 0:e.call(this);this._updateTimer&&(t==null||t.clearTimeout(this._updateTimer),delete this._updateTimer),this._updateDummyInputsTimer&&(t==null||t.clearTimeout(this._updateDummyInputsTimer),delete this._updateDummyInputsTimer),this._changedParents=new WeakSet,this._dummies.clear(),delete this._win}updatePositions(e){this._win&&(this._updateQueue.add(e),this._lastUpdateQueueTime=Date.now(),this._scheduledUpdatePositions())}_scheduledUpdatePositions(){var e;this._updateTimer||(this._updateTimer=(e=this._win)===null||e===void 0?void 0:e.call(this).setTimeout(()=>{if(delete this._updateTimer,this._lastUpdateQueueTime+ie<=Date.now()){const t=new Map,i=[];for(const s of this._updateQueue)i.push(s(t));this._updateQueue.clear();for(const s of i)s();t.clear()}else this._scheduledUpdatePositions()},ie))}}class lt{constructor(e,t,i,s,o,n,a){this._wrappers=[],this._isOutside=!1,this._transformElements=new Set,this._onFocusIn=(d,h,_)=>{this._onFocus(!0,d,h,_)},this._onFocusOut=(d,h,_)=>{this._onFocus(!1,d,h,_)},this.moveOut=d=>{var h;const _=this._firstDummy,m=this._lastDummy;if(_&&m){const g=_.input,v=m.input,E=(h=this._element)===null||h===void 0?void 0:h.get();if(g&&v&&E){let y;d?(g.tabIndex=0,y=g):(v.tabIndex=0,y=v),y&&P(y)}}},this.moveOutWithDefaultAction=d=>{var h;const _=this._firstDummy,m=this._lastDummy;if(_&&m){const g=_.input,v=m.input,E=(h=this._element)===null||h===void 0?void 0:h.get();if(g&&v&&E){let y;d?!_.isOutside&&this._tabster.focusable.isFocusable(E,!0,!0,!0)?y=E:(_.useDefaultAction=!0,g.tabIndex=0,y=g):(m.useDefaultAction=!0,v.tabIndex=0,y=v),y&&P(y)}}},this.setTabbable=(d,h)=>{var _,m;for(const v of this._wrappers)if(v.manager===d){v.tabbable=h;break}const g=this._getCurrent();if(g){const v=g.tabbable?0:-1;let E=(_=this._firstDummy)===null||_===void 0?void 0:_.input;E&&(E.tabIndex=v),E=(m=this._lastDummy)===null||m===void 0?void 0:m.input,E&&(E.tabIndex=v)}},this._addDummyInputs=()=>{this._addTimer||(this._addTimer=this._getWindow().setTimeout(()=>{var d,h,_;delete this._addTimer;const m=(d=this._element)===null||d===void 0?void 0:d.get(),g=(h=this._firstDummy)===null||h===void 0?void 0:h.input,v=(_=this._lastDummy)===null||_===void 0?void 0:_.input;if(!(!m||!g||!v)){if(this._isOutside){const E=m.parentElement;if(E){const y=m.nextElementSibling;y!==v&&E.insertBefore(v,y),m.previousElementSibling!==g&&E.insertBefore(g,m)}}else{m.lastElementChild!==v&&m.appendChild(v);const E=m.firstElementChild;E&&E!==g&&m.insertBefore(g,E)}this._addTransformOffsets()}},0))},this._addTransformOffsets=()=>{this._tabster._dummyObserver.updatePositions(this._computeTransformOffsets)},this._computeTransformOffsets=d=>{var h,_;const m=((h=this._firstDummy)===null||h===void 0?void 0:h.input)||((_=this._lastDummy)===null||_===void 0?void 0:_.input),g=this._transformElements,v=new Set;let E=0,y=0;const w=this._getWindow();for(let p=m;p;p=p.parentElement){let F=d.get(p);if(F===void 0){const R=w.getComputedStyle(p).transform;R&&R!=="none"&&(F={scrollTop:p.scrollTop,scrollLeft:p.scrollLeft}),d.set(p,F||null)}F&&(v.add(p),g.has(p)||p.addEventListener("scroll",this._addTransformOffsets),E+=F.scrollTop,y+=F.scrollLeft)}for(const p of g)v.has(p)||p.removeEventListener("scroll",this._addTransformOffsets);return this._transformElements=v,()=>{var p,F;(p=this._firstDummy)===null||p===void 0||p.setTopLeft(E,y),(F=this._lastDummy)===null||F===void 0||F.setTopLeft(E,y)}};const r=t.get();if(!r)throw new Error("No element");this._tabster=e,this._getWindow=e.getWindow,this._callForDefaultAction=a;const c=r.__tabsterDummy;if((c||this)._wrappers.push({manager:i,priority:s,tabbable:!0}),c)return c;r.__tabsterDummy=this;const u=o==null?void 0:o.dummyInputsPosition,f=r.tagName;this._isOutside=u?u===ze.Outside:(n||f==="UL"||f==="OL"||f==="TABLE")&&!(f==="LI"||f==="TD"||f==="TH"),this._firstDummy=new le(this._getWindow,this._isOutside,{isFirst:!0},t),this._lastDummy=new le(this._getWindow,this._isOutside,{isFirst:!1},t);const b=this._firstDummy.input;b&&e._dummyObserver.add(b,this._addDummyInputs),this._firstDummy.onFocusIn=this._onFocusIn,this._firstDummy.onFocusOut=this._onFocusOut,this._lastDummy.onFocusIn=this._onFocusIn,this._lastDummy.onFocusOut=this._onFocusOut,this._element=t,this._addDummyInputs()}dispose(e,t){var i,s,o,n;if((this._wrappers=this._wrappers.filter(r=>r.manager!==e&&!t)).length===0){delete((i=this._element)===null||i===void 0?void 0:i.get()).__tabsterDummy;for(const u of this._transformElements)u.removeEventListener("scroll",this._addTransformOffsets);this._transformElements.clear();const r=this._getWindow();this._addTimer&&(r.clearTimeout(this._addTimer),delete this._addTimer);const c=(s=this._firstDummy)===null||s===void 0?void 0:s.input;c&&this._tabster._dummyObserver.remove(c),(o=this._firstDummy)===null||o===void 0||o.dispose(),(n=this._lastDummy)===null||n===void 0||n.dispose()}}_onFocus(e,t,i,s){var o;const n=this._getCurrent();n&&(!t.useDefaultAction||this._callForDefaultAction)&&((o=n.manager.getHandler(e))===null||o===void 0||o(t,i,s))}_getCurrent(){return this._wrappers.sort((e,t)=>e.tabbable!==t.tabbable?e.tabbable?-1:1:e.priority-t.priority),this._wrappers[0]}}function ue(l){let e=null;for(let t=l.lastElementChild;t;t=t.lastElementChild)e=t;return e||void 0}function ye(l,e){let t=l,i=null;for(;t&&!i;)i=e?t.previousElementSibling:t.nextElementSibling,t=t.parentElement;return i||void 0}function U(l,e,t){const i=document.createEvent("HTMLEvents");return i.initEvent(e,!0,!0),i.details=t,l.dispatchEvent(i),!i.defaultPrevented}function se(l,e,t,i){const s=l.storageEntry(e,!0);let o=!1;if(!s.aug){if(i===void 0)return o;s.aug={}}if(i===void 0){if(t in s.aug){const n=s.aug[t];delete s.aug[t],n===null?e.removeAttribute(t):e.setAttribute(t,n),o=!0}}else{let n;t in s.aug||(n=e.getAttribute(t)),n!==void 0&&n!==i&&(s.aug[t]=n,i===null?e.removeAttribute(t):e.setAttribute(t,i),o=!0)}return i===void 0&&Object.keys(s.aug).length===0&&(delete s.aug,l.storageEntry(e,!1)),o}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */function ut(l,e){const t=JSON.stringify(l);return e===!0?t:{[N]:t}}function ct(l,e){for(const t of Object.keys(e)){const i=e[t];i?l[t]=i:delete l[t]}}function dt(l,e,t){let i;if(t){const s=l.getAttribute(N);if(s)try{i=JSON.parse(s)}catch{}}i||(i={}),ct(i,e),Object.keys(i).length>0?l.setAttribute(N,ut(i,!0)):l.removeAttribute(N)}class Te extends A{constructor(e,t,i,s){super(e,t,de.Root,s,void 0,!0),this._onDummyInputFocus=o=>{var n;if(o.useDefaultAction)this._setFocused(!1,!0);else{this._tabster.keyboardNavigation.setNavigatingWithKeyboard(!0);const a=this._element.get();if(a){this._setFocused(!0,!0);const r=this._tabster.focusedElement.getFirstOrLastTabbable(o.isFirst,{container:a,ignoreAccessibility:!0});if(r){P(r);return}}(n=o.input)===null||n===void 0||n.blur()}},this._setHandlers(this._onDummyInputFocus),this._tabster=e,this._setFocused=i}}class ft extends J{constructor(e,t,i,s,o){super(e,t,s),this._isFocused=!1,this._setFocused=(a,r)=>{if(this._setFocusedTimer&&(this._tabster.getWindow().clearTimeout(this._setFocusedTimer),delete this._setFocusedTimer),this._isFocused===a)return;const c=this._element.get();c&&(a?(this._isFocused=!0,U(this._tabster.root.eventTarget,"focus",{element:c,fromAdjacent:r})):this._setFocusedTimer=this._tabster.getWindow().setTimeout(()=>{delete this._setFocusedTimer,this._isFocused=!1,U(this._tabster.root.eventTarget,"blur",{element:c,fromAdjacent:r})},0))},this._onFocus=a=>{var r;const c=this._tabster.getWindow();if(this._setTabbableTimer&&(c.clearTimeout(this._setTabbableTimer),delete this._setTabbableTimer),a){const u=C.getTabsterContext(this._tabster,a);if(u&&this._setFocused(u.root.getElement()===this._element.get()),!u||u.uncontrolled||this._tabster.rootDummyInputs){(r=this._dummyManager)===null||r===void 0||r.setTabbable(!1);return}}else this._setFocused(!1);this._setTabbableTimer=c.setTimeout(()=>{var u;delete this._setTabbableTimer,(u=this._dummyManager)===null||u===void 0||u.setTabbable(!0)},0)},this._onDispose=i;const n=e.getWindow;this.uid=K(n,t),this._sys=o,(e.controlTab||e.rootDummyInputs)&&this.addDummyInputs(),e.focusedElement.subscribe(this._onFocus),this._add()}addDummyInputs(){this._dummyManager||(this._dummyManager=new Te(this._tabster,this._element,this._setFocused,this._sys))}dispose(){var e;this._onDispose(this);const t=this._tabster.getWindow();this._setFocusedTimer&&(t.clearTimeout(this._setFocusedTimer),delete this._setFocusedTimer),this._setTabbableTimer&&(t.clearTimeout(this._setTabbableTimer),delete this._setTabbableTimer),(e=this._dummyManager)===null||e===void 0||e.dispose(),this._remove()}moveOutWithDefaultAction(e){const t=this._dummyManager;if(t)t.moveOutWithDefaultAction(e);else{const i=this.getElement();i&&Te.moveWithPhantomDummy(this._tabster,i,!0,e)}}_add(){}_remove(){}}class C{constructor(e,t){this._autoRootWaiting=!1,this._roots={},this._forceDummy=!1,this.rootById={},this._autoRootCreate=()=>{var i;const s=this._win().document,o=s.body;if(o){this._autoRootUnwait(s);const n=this._autoRoot;if(n)return dt(o,{root:n},!0),Ne(this._tabster,o),(i=k(this._tabster,o))===null||i===void 0?void 0:i.root}else this._autoRootWaiting||(this._autoRootWaiting=!0,s.addEventListener("readystatechange",this._autoRootCreate))},this._onRootDispose=i=>{delete this._roots[i.id]},this._tabster=e,this._win=e.getWindow,this._autoRoot=t,this.eventTarget=Ye(this._win),e.queueInit(()=>{this._autoRoot&&this._autoRootCreate()})}_autoRootUnwait(e){e.removeEventListener("readystatechange",this._autoRootCreate),this._autoRootWaiting=!1}dispose(){const e=this._win();this._autoRootUnwait(e.document),delete this._autoRoot,Object.keys(this._roots).forEach(t=>{this._roots[t]&&(this._roots[t].dispose(),delete this._roots[t])}),this.rootById={}}createRoot(e,t,i){const s=new ft(this._tabster,e,this._onRootDispose,t,i);return this._roots[s.id]=s,this._forceDummy&&s.addDummyInputs(),s}addDummyInputs(){this._forceDummy=!0;const e=this._roots;for(const t of Object.keys(e))e[t].addDummyInputs()}static getRootByUId(e,t){const i=e().__tabsterInstance;return i&&i.root.rootById[t]}static getTabsterContext(e,t,i){i===void 0&&(i={});var s,o,n,a;if(!t.ownerDocument)return;e.drainInitQueue();const r=i.checkRtl;let c,u,f,b,d=!1,h,_,m,g,v=t;const E={};for(;v&&(!c||r);){const w=k(e,v);if(r&&m===void 0){const T=v.dir;T&&(m=T.toLowerCase()==="rtl")}if(!w){v=v.parentElement;continue}const p=v.tagName;(w.uncontrolled||p==="IFRAME"||p==="WEBVIEW")&&(g=v),!b&&(!((s=w.focusable)===null||s===void 0)&&s.excludeFromMover)&&!f&&(d=!0);const F=w.modalizer,R=w.groupper,O=w.mover;!u&&F&&(u=F),!f&&R&&(!u||F)&&(u?(!R.isActive()&&R.getProps().tabbability&&u.userId!==((o=e.modalizer)===null||o===void 0?void 0:o.activeId)&&(u=void 0,f=R),_=R):f=R),!b&&O&&(!u||F)&&(!R||v!==t)&&(b=O,h=!!f&&f!==R),w.root&&(c=w.root),!((n=w.focusable)===null||n===void 0)&&n.ignoreKeydown&&Object.assign(E,w.focusable.ignoreKeydown),v=v.parentElement}if(!c){const w=e.root;w._autoRoot&&!((a=t.ownerDocument)===null||a===void 0)&&a.body&&(c=w._autoRootCreate())}return f&&!b&&(h=!0),c?{root:c,modalizer:u,groupper:f,mover:b,isGroupperFirst:h,modalizerInGroupper:_,isRtl:r?!!m:void 0,uncontrolled:g,isExcludedFromMover:d,ignoreKeydown:w=>!!E[w.key]}:void 0}static getRoot(e,t){var i;for(let s=t;s;s=s.parentElement){const o=(i=k(e,s))===null||i===void 0?void 0:i.root;if(o)return o}}onRoot(e,t){t?delete this.rootById[e.uid]:this.rootById[e.uid]=e}}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */const H=10;class ht{}class _t extends ht{constructor(e,t){super(),this.uid=t.uid,this._tabster=e,this._deloser=t}belongsTo(e){return e===this._deloser}unshift(e){this._deloser.unshift(e)}async focusAvailable(){const e=this._deloser.findAvailable();return e?this._tabster.focusedElement.focus(e):!1}async resetFocus(){const e=this._tabster.getWindow;return Ke(e).resolve(this._deloser.resetFocus())}}class mt{constructor(e,t){this._history=[],this._tabster=e,this.rootUId=t}getLength(){return this._history.length}removeDeloser(e){this._history=this._history.filter(t=>!t.belongsTo(e))}hasDeloser(e){return this._history.some(t=>t.belongsTo(e))}}class vt extends mt{unshiftToDeloser(e,t){let i;for(let s=0;s<this._history.length;s++)if(this._history[s].belongsTo(e)){i=this._history[s],this._history.splice(s,1);break}i||(i=new _t(this._tabster,e)),i.unshift(t),this._history.unshift(i),this._history.splice(H,this._history.length-H)}async focusAvailable(e){let t=!!e;for(const i of this._history)if(e&&i.belongsTo(e)&&(t=!1),!t&&await i.focusAvailable())return!0;return!1}async resetFocus(e){let t=!!e;const i={};for(const s of this._history)e&&s.belongsTo(e)&&(t=!1),!t&&!i[s.uid]&&(i[s.uid]=s);for(const s of Object.keys(i))if(await i[s].resetFocus())return!0;return!1}}class bt{constructor(e){this._history=[],this._tabster=e}dispose(){this._history=[]}process(e){var t;const i=C.getTabsterContext(this._tabster,e),s=i&&i.root.uid,o=He.getDeloser(this._tabster,e);if(!s||!o)return;const n=this.make(s,()=>new vt(this._tabster,s));return(!i||!i.modalizer||!((t=i.modalizer)===null||t===void 0)&&t.isActive())&&n.unshiftToDeloser(o,e),o}make(e,t){let i;for(let s=0;s<this._history.length;s++){const o=this._history[s];if(o.rootUId===e){i=o,this._history.splice(s,1);break}}return i||(i=t()),this._history.unshift(i),this._history.splice(H,this._history.length-H),i}removeDeloser(e){this._history.forEach(t=>{t.removeDeloser(e)}),this._history=this._history.filter(t=>t.getLength()>0)}async focusAvailable(e){let t=!!e;for(const i of this._history)if(e&&i.hasDeloser(e)&&(t=!1),!t&&await i.focusAvailable(e))return!0;return!1}async resetFocus(e){let t=!!e;for(const i of this._history)if(e&&i.hasDeloser(e)&&(t=!1),!t&&await i.resetFocus(e))return!0;return!1}}function we(l,e,t){const i=[],s=/(:|\.|\[|\]|,|=|@)/g,o="\\$1";l.id&&i.push("#"+l.id.replace(s,o)),e!==!1&&l.className&&l.className.split(" ").forEach(r=>{r=r.trim(),r&&i.push("."+r.replace(s,o))});let n=0,a;if(t!==!1&&i.length===0){for(a=l;a;)n++,a=a.previousElementSibling;i.unshift(":nth-child("+n+")")}return i.unshift(l.tagName.toLowerCase()),i.join("")}function pt(l){if(!Q(l.ownerDocument,l))return;const e=[we(l)];let t=l.parentElement;for(;t;){const i=t.tagName==="BODY";if(e.unshift(we(t,!1,!i)),i)break;t=t.parentElement}return e.join(" ")}class Fe extends J{constructor(e,t,i,s){super(e,t,s),this._isActive=!1,this._history=[[]],this._snapshotIndex=0,this.isActive=()=>this._isActive,this.setSnapshot=o=>{this._snapshotIndex=o,this._history.length>o+1&&this._history.splice(o+1,this._history.length-o-1),this._history[o]||(this._history[o]=[])},this.focusFirst=()=>{const o=this._element.get();return!!o&&this._tabster.focusedElement.focusFirst({container:o})},this.focusDefault=()=>{const o=this._element.get();return!!o&&this._tabster.focusedElement.focusDefault(o)},this.resetFocus=()=>{const o=this._element.get();return!!o&&this._tabster.focusedElement.resetFocus(o)},this.clearHistory=o=>{const n=this._element.get();if(!n){this._history[this._snapshotIndex]=[];return}this._history[this._snapshotIndex]=this._history[this._snapshotIndex].filter(a=>{const r=a.get();return r&&o?n.contains(r):!1})},this.uid=K(e.getWindow,t),this._onDispose=i}dispose(){this._remove(),this._onDispose(this),this._isActive=!1,this._snapshotIndex=0,this._props={},this._history=[]}setActive(e){this._isActive=e}getActions(){return{focusDefault:this.focusDefault,focusFirst:this.focusFirst,resetFocus:this.resetFocus,clearHistory:this.clearHistory,setSnapshot:this.setSnapshot,isActive:this.isActive}}unshift(e){let t=this._history[this._snapshotIndex];for(t=this._history[this._snapshotIndex]=t.filter(i=>{const s=i.get();return s&&s!==e}),t.unshift(new L(this._tabster.getWindow,e,pt(e)));t.length>H;)t.pop()}findAvailable(){const e=this._element.get();if(!e||!this._tabster.focusable.isVisible(e))return null;let t=this._props.restoreFocusOrder,i=null;const s=C.getTabsterContext(this._tabster,e);if(!s)return null;const o=s.root,n=o.getElement();if(!n)return null;if(t===void 0&&(t=o.getProps().restoreFocusOrder),t===S.RootDefault&&(i=this._tabster.focusable.findDefault({container:n})),!i&&t===S.RootFirst&&(i=this._findFirst(n)),i)return i;const a=this._findInHistory(),r=this._tabster.focusable.findDefault({container:e}),c=this._findFirst(e);return a&&t===S.History?a:r&&t===S.DeloserDefault?r:c&&t===S.DeloserFirst?c:r||a||c||null}customFocusLostHandler(e){return U(e,Ce,this.getActions())}_findInHistory(){const e=this._history[this._snapshotIndex].slice(0);this.clearHistory(!0);for(let t=0;t<e.length;t++){const i=e[t],s=i.get(),o=this._element.get();if(s&&o&&o.contains(s)){if(this._tabster.focusable.isFocusable(s))return s}else if(!this._props.noSelectorCheck){const n=i.getData();if(n&&o){let a;try{a=o.ownerDocument.querySelectorAll(n)}catch{continue}for(let r=0;r<a.length;r++){const c=a[r];if(c&&this._tabster.focusable.isFocusable(c))return c}}}}return null}_findFirst(e){if(this._tabster.keyboardNavigation.isNavigatingWithKeyboard()){const t=this._tabster.focusable.findFirst({container:e,ignoreUncontrolled:!0,useActiveModalizer:!0});if(t)return t}return null}_remove(){}}class He{constructor(e,t){this._inDeloser=!1,this._isRestoringFocus=!1,this._isPaused=!1,this._onFocus=s=>{if(this._restoreFocusTimer&&(this._win().clearTimeout(this._restoreFocusTimer),this._restoreFocusTimer=void 0),!s){this._scheduleRestoreFocus();return}const o=this._history.process(s);o?this._activate(o):this._deactivate()},this._onDeloserDispose=s=>{this._history.removeDeloser(s),s.isActive()&&this._scheduleRestoreFocus()},this._tabster=e,this._win=e.getWindow,this._history=new bt(e),e.queueInit(()=>{this._tabster.focusedElement.subscribe(this._onFocus)});const i=t==null?void 0:t.autoDeloser;i&&(this._autoDeloser=i)}dispose(){const e=this._win();this._restoreFocusTimer&&(e.clearTimeout(this._restoreFocusTimer),this._restoreFocusTimer=void 0),this._autoDeloserInstance&&(this._autoDeloserInstance.dispose(),delete this._autoDeloserInstance,delete this._autoDeloser),this._tabster.focusedElement.unsubscribe(this._onFocus),this._history.dispose(),delete this._curDeloser}createDeloser(e,t){var i;const s=new Fe(this._tabster,e,this._onDeloserDispose,t);return e.contains((i=this._tabster.focusedElement.getFocusedElement())!==null&&i!==void 0?i:null)&&this._activate(s),s}getActions(e){for(let t=e;t;t=t.parentElement){const i=k(this._tabster,t);if(i&&i.deloser)return i.deloser.getActions()}}pause(){this._isPaused=!0,this._restoreFocusTimer&&(this._win().clearTimeout(this._restoreFocusTimer),this._restoreFocusTimer=void 0)}resume(e){this._isPaused=!1,e&&this._scheduleRestoreFocus()}_activate(e){const t=this._curDeloser;t!==e&&(this._inDeloser=!0,t==null||t.setActive(!1),e.setActive(!0),this._curDeloser=e)}_deactivate(){var e;this._inDeloser=!1,(e=this._curDeloser)===null||e===void 0||e.setActive(!1),this._curDeloser=void 0}_scheduleRestoreFocus(e){if(this._isPaused||this._isRestoringFocus)return;const t=async()=>{this._restoreFocusTimer=void 0;const i=this._tabster.focusedElement.getLastFocusedElement();if(!e&&(this._isRestoringFocus||!this._inDeloser||i!=null&&i.offsetParent))return;const s=this._curDeloser;if(s){if(i&&s.customFocusLostHandler(i))return;const o=s.findAvailable();if(o&&this._tabster.focusedElement.focus(o))return}this._deactivate(),this._isRestoringFocus=!0,await this._history.focusAvailable(null)||await this._history.resetFocus(null),this._isRestoringFocus=!1};e?t():this._restoreFocusTimer=this._win().setTimeout(t,100)}static getDeloser(e,t){var i;let s;for(let n=t;n;n=n.parentElement){const a=k(e,n);if(a){s||(s=a.root);const r=a.deloser;if(r)return r}}const o=e.deloser&&e.deloser;if(o){if(o._autoDeloserInstance)return o._autoDeloserInstance;const n=o._autoDeloser;if(s&&!o._autoDeloserInstance&&n){const a=(i=t.ownerDocument)===null||i===void 0?void 0:i.body;a&&(o._autoDeloserInstance=new Fe(e,a,e.deloser._onDeloserDispose,n))}return o._autoDeloserInstance}}static getHistory(e){return e._history}static forceRestoreFocus(e){e._scheduleRestoreFocus(!0)}}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */class je{constructor(){this._callbacks=[]}dispose(){this._callbacks=[],delete this._val}subscribe(e){const t=this._callbacks;t.indexOf(e)<0&&t.push(e)}subscribeFirst(e){const t=this._callbacks,i=t.indexOf(e);i>=0&&t.splice(i,1),t.unshift(e)}unsubscribe(e){const t=this._callbacks.indexOf(e);t>=0&&this._callbacks.splice(t,1)}setVal(e,t){this._val!==e&&(this._val=e,this._callCallbacks(e,t))}getVal(){return this._val}trigger(e,t){this._callCallbacks(e,t)}_callCallbacks(e,t){this._callbacks.forEach(i=>i(e,t))}}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */const gt=["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","*[tabindex]","*[contenteditable]"].join(", ");class Et{constructor(e){this._tabster=e}dispose(){}getProps(e){const t=k(this._tabster,e);return t&&t.focusable||{}}isFocusable(e,t,i,s){return Ve(e,gt)&&(t||e.tabIndex!==-1)?(i||this.isVisible(e))&&(s||this.isAccessible(e)):!1}isVisible(e){if(!e.ownerDocument||e.offsetParent===null&&e.ownerDocument.body!==e)return!1;const t=e.ownerDocument.defaultView;if(!t)return!1;const i=e.ownerDocument.body.getBoundingClientRect();return!(i.width===0&&i.height===0||t.getComputedStyle(e).visibility==="hidden")}isAccessible(e){var t;for(let i=e;i;i=i.parentElement){const s=k(this._tabster,i);if(this._isHidden(i)||!((t=s==null?void 0:s.focusable)===null||t===void 0?void 0:t.ignoreAriaDisabled)&&this._isDisabled(i))return!1}return!0}_isDisabled(e){return e.hasAttribute("disabled")}_isHidden(e){var t;const i=e.getAttribute("aria-hidden");return!!(i&&i.toLowerCase()==="true"&&!(!((t=this._tabster.modalizer)===null||t===void 0)&&t.isAugmented(e)))}findFirst(e){return this.findElement({...e})}findLast(e){return this.findElement({isBackward:!0,...e})}findNext(e){return this.findElement({...e})}findPrev(e){return this.findElement({isBackward:!0,...e})}findDefault(e){return this.findElement({...e,acceptCondition:t=>this._tabster.focusable.isFocusable(t,e.includeProgrammaticallyFocusable)&&!!this.getProps(t).isDefault})||null}findAll(e){return this._findElements(!0,e)||[]}findElement(e){const t=this._findElements(!1,e);return t&&t[0]}_findElements(e,t){var i,s,o;const{container:n,currentElement:a=null,includeProgrammaticallyFocusable:r,useActiveModalizer:c,ignoreUncontrolled:u,ignoreAccessibility:f,modalizerId:b,isBackward:d,onUncontrolled:h,onElement:_}=t,m=[];let{acceptCondition:g}=t;if(!n)return null;g||(g=p=>this._tabster.focusable.isFocusable(p,r,!1,f));const v={container:n,modalizerUserId:b===void 0&&c?(i=this._tabster.modalizer)===null||i===void 0?void 0:i.activeId:b||((o=(s=C.getTabsterContext(this._tabster,n))===null||s===void 0?void 0:s.modalizer)===null||o===void 0?void 0:o.userId),from:a||n,isBackward:d,acceptCondition:g,includeProgrammaticallyFocusable:r,ignoreUncontrolled:u,ignoreAccessibility:f,cachedGrouppers:{}},E=ce(n.ownerDocument,n,p=>this._acceptElement(p,v));if(!E)return null;const y=p=>{const F=v.foundElement;return F&&m.push(F),e?F&&(v.found=!1,delete v.foundElement,delete v.fromCtx,v.from=F,_&&!_(F))?!1:!!(F||p):!!(p&&!F)};if(a)E.currentNode=a;else if(d){const p=ue(n);if(!p)return null;if(this._acceptElement(p,v)===NodeFilter.FILTER_ACCEPT&&!y(!0))return m;E.currentNode=p}let w;do w=(d?E.previousNode():E.nextNode())||void 0;while(y());if(!e){const p=v.nextUncontrolled;if(p)return h&&h(p),w?void 0:null}return m.length?m:null}_acceptElement(e,t){var i,s,o,n,a;if(t.found)return NodeFilter.FILTER_ACCEPT;const r=t.container;if(e===r)return NodeFilter.FILTER_SKIP;if(!r.contains(e)||e.__tabsterDummyContainer)return NodeFilter.FILTER_REJECT;let c=t.lastToIgnore;if(c){if(c.contains(e))return NodeFilter.FILTER_REJECT;c=t.lastToIgnore=void 0}const u=t.currentCtx=C.getTabsterContext(this._tabster,e);if(!u)return NodeFilter.FILTER_SKIP;if(t.ignoreUncontrolled){if(Be(e))return NodeFilter.FILTER_SKIP}else if(u.uncontrolled&&!t.nextUncontrolled&&this._tabster.focusable.isFocusable(e,void 0,!0,!0)&&!u.groupper&&!u.mover&&((i=u.modalizer)===null||i===void 0?void 0:i.userId)===((s=this._tabster.modalizer)===null||s===void 0?void 0:s.activeId))return this.isVisible(u.uncontrolled)&&(t.nextUncontrolled=u.uncontrolled),NodeFilter.FILTER_REJECT;if(e.tagName==="IFRAME"||e.tagName==="WEBVIEW")return((o=u.modalizer)===null||o===void 0?void 0:o.userId)===((n=this._tabster.modalizer)===null||n===void 0?void 0:n.activeId)?(t.found=!0,t.lastToIgnore=t.foundElement=e,NodeFilter.FILTER_ACCEPT):NodeFilter.FILTER_REJECT;if(!t.ignoreAccessibility&&!this.isAccessible(e))return NodeFilter.FILTER_REJECT;let f,b=t.fromCtx;b||(b=t.fromCtx=C.getTabsterContext(this._tabster,t.from));const d=b==null?void 0:b.mover;let h=u.groupper,_=u.mover;if(f=(a=this._tabster.modalizer)===null||a===void 0?void 0:a.acceptElement(e,t),f===void 0&&(h||_||d)){const m=h==null?void 0:h.getElement(),g=d==null?void 0:d.getElement();let v=_==null?void 0:_.getElement();v&&g&&r.contains(g)&&(!m||!_||g.contains(m))&&(_=d,v=g),m&&(m===r||!r.contains(m))&&(h=void 0),v&&!r.contains(v)&&(_=void 0),h&&_&&(v&&m&&!m.contains(v)?_=void 0:h=void 0),h&&(f=h.acceptElement(e,t)),_&&(f=_.acceptElement(e,t))}return f===void 0&&(f=t.acceptCondition(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP),f===NodeFilter.FILTER_ACCEPT&&!t.found&&(t.found=!0,t.foundElement=e),f}}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */const I={Tab:9,Enter:13,Esc:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40};/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */class M extends je{constructor(e,t){super(),this._init=()=>{const i=this._win(),s=i.document;s.addEventListener(ve,this._onFocusIn,!0),s.addEventListener("focusout",this._onFocusOut,!0),i.addEventListener("keydown",this._onKeyDown,!0);const o=s.activeElement;o&&o!==s.body&&this._setFocusedElement(o),this.subscribe(this._onChanged)},this._onFocusIn=i=>{this._setFocusedElement(i.target,i.details.relatedTarget,i.details.isFocusedProgrammatically)},this._onFocusOut=i=>{this._setFocusedElement(void 0,i.relatedTarget)},this._validateFocusedElement=i=>{},this._onKeyDown=i=>{var s,o,n,a,r,c;if(i.keyCode!==I.Tab||i.ctrlKey)return;const u=this.getVal();if(!u||!u.ownerDocument||u.contentEditable==="true")return;const f=this._tabster,b=f.controlTab,d=C.getTabsterContext(f,u);if(!d||d.ignoreKeydown(i))return;const h=i.shiftKey,_=M.findNextTabbable(f,d,void 0,u,h,void 0,!0);let m;if(_){let g=_.uncontrolled;if(g){const v=d.isGroupperFirst;let E=!1;if(v!==void 0){const y=(s=d.groupper)===null||s===void 0?void 0:s.getElement(),w=(o=d.mover)===null||o===void 0?void 0:o.getElement();let p;v&&y&&g.contains(y)?p=y:!v&&w&&g.contains(w)&&(p=w),p&&(g=p,E=!0)}g&&d.uncontrolled!==g&&A.moveWithPhantomDummy(this._tabster,g,E,h);return}m=_.element}if(m){const g=()=>{i.preventDefault(),i.stopImmediatePropagation()};if(b)m.tagName!=="IFRAME"&&(g(),P(m));else{const v=_==null?void 0:_.lastMoverOrGroupper;let E=_==null?void 0:_.outOfDOMOrder;if(!E&&u.compareDocumentPosition(m)&(h?document.DOCUMENT_POSITION_FOLLOWING:document.DOCUMENT_POSITION_PRECEDING)&&(E=!0),E)g(),P(m);else if(v)(n=v.dummyManager)===null||n===void 0||n.moveOutWithDefaultAction(h);else if(d.modalizer){const y=C.getTabsterContext(f,m);(!y||d.root.uid!==y.root.uid||!(!((a=y.modalizer)===null||a===void 0)&&a.isActive()))&&d.modalizer.triggerFocusEvent(ke,!0)?g():!((r=d.modalizer.getElement())===null||r===void 0)&&r.contains(m)||(g(),(c=d.modalizer.dummyManager)===null||c===void 0||c.moveOut(h))}}}else d.root.moveOutWithDefaultAction(h)},this._onChanged=(i,s)=>{var o,n;if(i)U(i,xe,s);else{const a=(o=this._lastVal)===null||o===void 0?void 0:o.get();if(a){const r={...s},c=C.getTabsterContext(this._tabster,a),u=(n=c==null?void 0:c.modalizer)===null||n===void 0?void 0:n.userId;u&&(r.modalizerId=u),U(a,Ae,r)}}},this._tabster=e,this._win=t,e.queueInit(this._init)}dispose(){super.dispose();const e=this._win();e.document.removeEventListener(ve,this._onFocusIn,!0),e.document.removeEventListener("focusout",this._onFocusOut,!0),e.removeEventListener("keydown",this._onKeyDown,!0),this.unsubscribe(this._onChanged),delete M._lastResetElement,delete this._nextVal,delete this._lastVal}static forgetMemorized(e,t){var i,s;let o=M._lastResetElement,n=o&&o.get();n&&t.contains(n)&&delete M._lastResetElement,n=(s=(i=e._nextVal)===null||i===void 0?void 0:i.element)===null||s===void 0?void 0:s.get(),n&&t.contains(n)&&delete e._nextVal,o=e._lastVal,n=o&&o.get(),n&&t.contains(n)&&delete e._lastVal}getFocusedElement(){return this.getVal()}getLastFocusedElement(){var e;let t=(e=this._lastVal)===null||e===void 0?void 0:e.get();return(!t||t&&!Q(t.ownerDocument,t))&&(this._lastVal=t=void 0),t}focus(e,t,i){return this._tabster.focusable.isFocusable(e,t,!1,i)?(e.focus(),!0):!1}focusDefault(e){const t=this._tabster.focusable.findDefault({container:e});return t?(this._tabster.focusedElement.focus(t),!0):!1}getFirstOrLastTabbable(e,t){const i=this._tabster.focusable,{container:s,ignoreAccessibility:o}=t;let n,a;if(s){const r=C.getTabsterContext(this._tabster,s);if(r){let c=M.findNextTabbable(this._tabster,r,s,void 0,!e,void 0,o);if(c)for(a=c.element,n=c.uncontrolled;!a&&n;)i.isFocusable(n,!1,!0,!0)?a=n:a=i[e?"findFirst":"findLast"]({container:n,ignoreUncontrolled:!0,ignoreAccessibility:o,useActiveModalizer:!0}),a||(c=M.findNextTabbable(this._tabster,r,n,void 0,!e,void 0,o),c&&(a=c.element,n=c.uncontrolled))}}return a&&!(s!=null&&s.contains(a))&&(a=void 0),a||void 0}_focusFirstOrLast(e,t){const i=this.getFirstOrLastTabbable(e,t);return i?(this.focus(i,!1,!0),!0):!1}focusFirst(e){return this._focusFirstOrLast(!0,e)}focusLast(e){return this._focusFirstOrLast(!1,e)}resetFocus(e){if(!this._tabster.focusable.isVisible(e))return!1;if(this._tabster.focusable.isFocusable(e,!0,!0,!0))this.focus(e);else{const t=e.getAttribute("tabindex"),i=e.getAttribute("aria-hidden");e.tabIndex=-1,e.setAttribute("aria-hidden","true"),M._lastResetElement=new L(this._win,e),this.focus(e,!0,!0),this._setOrRemoveAttribute(e,"tabindex",t),this._setOrRemoveAttribute(e,"aria-hidden",i)}return!0}_setOrRemoveAttribute(e,t,i){i===null?e.removeAttribute(t):e.setAttribute(t,i)}_setFocusedElement(e,t,i){var s,o;if(this._tabster._noop)return;const n={relatedTarget:t};if(e){const r=(s=M._lastResetElement)===null||s===void 0?void 0:s.get();if(M._lastResetElement=void 0,r===e||Be(e))return;n.isFocusedProgrammatically=i;const c=C.getTabsterContext(this._tabster,e),u=(o=c==null?void 0:c.modalizer)===null||o===void 0?void 0:o.userId;u&&(n.modalizerId=u)}const a=this._nextVal={element:e?new L(this._win,e):void 0,details:n};e&&e!==this._val&&this._validateFocusedElement(e),this._nextVal===a&&this.setVal(e,n),this._nextVal=void 0}setVal(e,t){super.setVal(e,t),e&&(this._lastVal=new L(this._win,e))}static findNextTabbable(e,t,i,s,o,n,a){const r=i||t.root.getElement();if(!r)return null;let c=null;const u=M._isTabbingTimer,f=e.getWindow();u&&f.clearTimeout(u),M.isTabbing=!0,M._isTabbingTimer=f.setTimeout(()=>{delete M._isTabbingTimer,M.isTabbing=!1},0);const b=(v,E)=>{c=v.findNextTabbable(E||s,o,n,a);const y=c==null?void 0:c.lastMoverOrGroupper;if(y&&!(c!=null&&c.element)&&!(c!=null&&c.uncontrolled)){const w=y.getElement(),p=w==null?void 0:w.parentElement,F=p&&C.getTabsterContext(e,p);if(F){const O=F.isGroupperFirst?F.groupper:F.mover;if(O){const T=o?w:ue(w);b(O,T),c&&(c.outOfDOMOrder=!0)}}}},d=t.modalizer,h=t.groupper,_=t.mover;if(h&&_)b(t.isGroupperFirst?h:_);else if(h)b(h);else if(_)b(_);else if(d)b(d);else{let v;const E=w=>{v=w},y=o?e.focusable.findPrev({container:r,currentElement:s,onUncontrolled:E,ignoreUncontrolled:n,ignoreAccessibility:a,useActiveModalizer:!0}):e.focusable.findNext({container:r,currentElement:s,onUncontrolled:E,ignoreUncontrolled:n,ignoreAccessibility:a,useActiveModalizer:!0});c={element:v?void 0:y,uncontrolled:v}}const m=c==null?void 0:c.lastMoverOrGroupper,g=m==null?void 0:m.getElement();if(g){c=null;const v=ye(g,o);if(v){const E=C.getTabsterContext(e,v,{checkRtl:!0});if(E){let y=ye(v,!o);y&&(o||(y=ue(y)||y),c=M.findNextTabbable(e,E,r,y,o,n,a),c&&!c.lastMoverOrGroupper&&(c.lastMoverOrGroupper=m))}}}return c}}M.isTabbing=!1;/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */class yt extends je{constructor(e){super(),this._onChange=t=>{this.setVal(t,void 0)},this._keyborg=Ge(e()),this._keyborg.subscribe(this._onChange)}dispose(){super.dispose(),this._keyborg&&(this._keyborg.unsubscribe(this._onChange),Qe(this._keyborg),delete this._keyborg)}setNavigatingWithKeyboard(e){var t;(t=this._keyborg)===null||t===void 0||t.setVal(e)}isNavigatingWithKeyboard(){var e;return!!(!((e=this._keyborg)===null||e===void 0)&&e.isNavigatingWithKeyboard())}}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */let Tt=0;const oe="aria-hidden";class wt extends A{constructor(e,t,i){super(t,e,de.Modalizer,i),this._setHandlers((s,o)=>{var n,a,r;const c=e.get(),u=c&&((n=C.getRoot(t,c))===null||n===void 0?void 0:n.getElement()),f=s.input;let b;if(u&&f){const d=(a=f.__tabsterDummyContainer)===null||a===void 0?void 0:a.get(),h=C.getTabsterContext(t,d||f);h&&(b=(r=M.findNextTabbable(t,h,u,f,o,!0,!0))===null||r===void 0?void 0:r.element),b&&P(b)}})}}class Ft extends J{constructor(e,t,i,s,o,n){super(e,t,s),this._wasFocused=0,this.userId=s.id,this._onDispose=i,this._activeElements=n,e.controlTab||(this.dummyManager=new wt(this._element,e,o))}makeActive(e){if(this._isActive!==e){this._isActive=e;const t=this.getElement();if(t){const i=this._activeElements,s=i.map(o=>o.deref()).indexOf(t);e?s<0&&i.push(new WeakRef(t)):s>=0&&i.splice(s,1)}this.triggerFocusEvent(e?Me:Oe)}}focused(e){return e||(this._wasFocused=++Tt),this._wasFocused}setProps(e){e.id&&(this.userId=e.id),this._props={...e}}dispose(){var e;this.makeActive(!1),this._onDispose(this),(e=this.dummyManager)===null||e===void 0||e.dispose(),this._activeElements=[],this._remove()}isActive(){return!!this._isActive}contains(e){var t;return!!(!((t=this.getElement())===null||t===void 0)&&t.contains(e))}findNextTabbable(e,t,i,s){var o,n;if(!this.getElement())return null;const r=this._tabster;let c=null,u;const f=d=>{u=d},b=e&&((o=C.getRoot(r,e))===null||o===void 0?void 0:o.getElement());return b&&(c=r.focusable[t?"findPrev":"findNext"]({container:b,currentElement:e,onUncontrolled:f,ignoreUncontrolled:i,ignoreAccessibility:s,useActiveModalizer:!0}),!u&&!c&&this._props.isTrapped&&(!((n=r.modalizer)===null||n===void 0)&&n.activeId)&&(c=r.focusable[t?"findLast":"findFirst"]({container:b,ignoreUncontrolled:!0,ignoreAccessibility:s,useActiveModalizer:!0}))),{element:c,uncontrolled:u}}triggerFocusEvent(e,t){const i=this.getElement();let s=!1;if(i){const o=t?this._activeElements.map(n=>n.deref()):[i];for(const n of o)n&&!U(n,e,{id:this.userId,element:i,eventName:e})&&(s=!0)}return s}_remove(){}}class It{constructor(e){this._onModalizerDispose=i=>{const s=i.id,o=i.userId,n=this._parts[o];delete this._modalizers[s],n&&(delete n[s],Object.keys(n).length===0&&(delete this._parts[o],this.activeId===o&&this.setActive(void 0)))},this._onKeyDown=i=>{var s;if(i.keyCode!==I.Esc)return;const o=this._tabster,n=o.focusedElement.getFocusedElement();if(n){const a=C.getTabsterContext(o,n),r=a==null?void 0:a.modalizer;if(a&&!a.groupper&&(r!=null&&r.isActive())&&!a.ignoreKeydown(i)){const c=r.userId;if(c){const u=this._parts[c];if(u){const f=Object.keys(u).map(b=>{var d;const h=u[b],_=h.getElement();let m;return _&&(m=(d=k(this._tabster,_))===null||d===void 0?void 0:d.groupper),h&&_&&m?{el:_,focusedSince:h.focused(!0)}:{focusedSince:0}}).filter(b=>b.focusedSince>0).sort((b,d)=>b.focusedSince>d.focusedSince?-1:b.focusedSince<d.focusedSince?1:0);if(f.length){const b=f[0].el;b&&((s=o.groupper)===null||s===void 0||s.handleKeyPress(b,i,!0))}}}}}},this._onFocus=(i,s)=>{var o,n;const a=i&&C.getTabsterContext(this._tabster,i);if(!a||!i)return;const r=this._augMap;for(let u=i;u;u=u.parentElement)r.has(u)&&(r.delete(u),se(this._tabster,u,oe));const c=a.modalizer;if((n=c||((o=k(this._tabster,i))===null||o===void 0?void 0:o.modalizer))===null||n===void 0||n.focused(),(c==null?void 0:c.userId)===this.activeId){this.currentIsOthersAccessible=c==null?void 0:c.getProps().isOthersAccessible;return}if(s.isFocusedProgrammatically||this.currentIsOthersAccessible||c!=null&&c.getProps().isAlwaysAccessible)this.setActive(c);else{const u=this._win();u.clearTimeout(this._restoreModalizerFocusTimer),this._restoreModalizerFocusTimer=u.setTimeout(()=>this._restoreModalizerFocus(i),100)}},this._tabster=e,this._win=e.getWindow,this._modalizers={},this._parts={},this._augMap=new WeakMap,this._aug=[],this.activeElements=[],e.controlTab||e.root.addDummyInputs(),this._win().addEventListener("keydown",this._onKeyDown,!0),e.queueInit(()=>{this._tabster.focusedElement.subscribe(this._onFocus)})}dispose(){const e=this._win();e.removeEventListener("keydown",this._onKeyDown,!0),Object.keys(this._modalizers).forEach(t=>{this._modalizers[t]&&(this._modalizers[t].dispose(),delete this._modalizers[t])}),e.clearTimeout(this._restoreModalizerFocusTimer),e.clearTimeout(this._hiddenUpdateTimer),this._parts={},delete this.activeId,this.activeElements=[],this._augMap=new WeakMap,this._aug=[],this._tabster.focusedElement.unsubscribe(this._onFocus)}createModalizer(e,t,i){var s;const o=new Ft(this._tabster,e,this._onModalizerDispose,t,i,this.activeElements),n=o.id,a=t.id;this._modalizers[n]=o;let r=this._parts[a];return r||(r=this._parts[a]={}),r[n]=o,e.contains((s=this._tabster.focusedElement.getFocusedElement())!==null&&s!==void 0?s:null)&&(a!==this.activeId?this.setActive(o):o.makeActive(!0)),o}isAugmented(e){return this._augMap.has(e)}hiddenUpdate(){this._hiddenUpdateTimer||(this._hiddenUpdateTimer=this._win().setTimeout(()=>{delete this._hiddenUpdateTimer,this._hiddenUpdate()},250))}setActive(e){const t=e==null?void 0:e.userId,i=this.activeId;if(i!==t){if(this.activeId=t,i){const s=this._parts[i];if(s)for(const o of Object.keys(s))s[o].makeActive(!1)}if(t){const s=this._parts[t];if(s)for(const o of Object.keys(s))s[o].makeActive(!0)}this.currentIsOthersAccessible=e==null?void 0:e.getProps().isOthersAccessible,this.hiddenUpdate()}}focus(e,t,i){const s=C.getTabsterContext(this._tabster,e),o=s==null?void 0:s.modalizer;if(o){this.setActive(o);const n=o.getProps(),a=o.getElement();if(a){if(t===void 0&&(t=n.isNoFocusFirst),!t&&this._tabster.keyboardNavigation.isNavigatingWithKeyboard()&&this._tabster.focusedElement.focusFirst({container:a})||(i===void 0&&(i=n.isNoFocusDefault),!i&&this._tabster.focusedElement.focusDefault(a)))return!0;this._tabster.focusedElement.resetFocus(a)}}return!1}acceptElement(e,t){var i;const s=t.modalizerUserId,o=(i=t.currentCtx)===null||i===void 0?void 0:i.modalizer;if(s)for(const n of this.activeElements){const a=n.deref();if(a&&(e.contains(a)||a===e))return NodeFilter.FILTER_SKIP}return s===(o==null?void 0:o.userId)||!s&&(o!=null&&o.getProps().isAlwaysAccessible)?void 0:NodeFilter.FILTER_SKIP}_hiddenUpdate(){var e;const t=this._tabster,i=t.getWindow().document.body,s=this.activeId,o=this._parts,n=[],a=[],r=[];for(const _ of Object.keys(o)){const m=o[_];for(const g of Object.keys(m)){const v=m[g],E=v.getElement(),w=v.getProps().isAlwaysAccessible;E&&(_===s?this.currentIsOthersAccessible||n.push(E):w?r.push(E):a.push(E))}}const c=this._augMap,u=n.length>0?[...n,...r]:void 0,f=[],b=new WeakMap,d=(_,m)=>{const g=_.tagName;if(g==="SCRIPT"||g==="STYLE")return;let v=!1;c.has(_)?m?v=!0:(c.delete(_),se(t,_,oe)):m&&se(t,_,oe,"true")&&(c.set(_,!0),v=!0),v&&(f.push(new WeakRef(_)),b.set(_,!0))},h=_=>{for(let m=_.firstElementChild;m;m=m.nextElementSibling){let g=!1,v=!1;if(u){for(const E of u){if(m===E){g=!0;break}if(m.contains(E)){v=!0;break}}v?h(m):g||d(m,!0)}else d(m,!1)}};u||r.forEach(_=>d(_,!1)),a.forEach(_=>d(_,!0)),i&&h(i),(e=this._aug)===null||e===void 0||e.map(_=>_.deref()).forEach(_=>{_&&!b.get(_)&&d(_,!1)}),this._aug=f,this._augMap=b}_restoreModalizerFocus(e){const t=e==null?void 0:e.ownerDocument;if(!e||!t)return;const i=C.getTabsterContext(this._tabster,e),s=i==null?void 0:i.modalizer,o=this.activeId;if(!s&&!o||s&&o===s.userId)return;const n=i==null?void 0:i.root.getElement();if(n){let a=this._tabster.focusable.findFirst({container:n,ignoreUncontrolled:!0,useActiveModalizer:!0});if(a){if(e.compareDocumentPosition(a)&document.DOCUMENT_POSITION_PRECEDING&&(a=this._tabster.focusable.findLast({container:n,ignoreUncontrolled:!0,useActiveModalizer:!0}),!a))throw new Error("Something went wrong.");this._tabster.focusedElement.focus(a);return}}e.blur()}}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */const Dt=["input","textarea","*[contenteditable]"].join(", ");class Rt extends A{constructor(e,t,i,s){super(t,e,de.Mover,s),this._onFocusDummyInput=o=>{var n,a;const r=this._element.get(),c=o.input;if(r&&c){const u=C.getTabsterContext(this._tabster,r);let f;u&&(f=(n=M.findNextTabbable(this._tabster,u,void 0,c,!o.isFirst,!0))===null||n===void 0?void 0:n.element);const b=(a=this._getMemorized())===null||a===void 0?void 0:a.get();b&&(f=b),f&&P(f)}},this._tabster=t,this._getMemorized=i,this._setHandlers(this._onFocusDummyInput)}}const ne=1,Ie=2,De=3;class Ct extends J{constructor(e,t,i,s,o){var n;super(e,t,s),this._visible={},this._onIntersection=r=>{for(const c of r){const u=c.target,f=K(this._win,u);let b,d=this._fullyVisible;if(c.intersectionRatio>=.25?(b=c.intersectionRatio>=.75?z.Visible:z.PartiallyVisible,b===z.Visible&&(d=f)):b=z.Invisible,this._visible[f]!==b){b===void 0?(delete this._visible[f],d===f&&delete this._fullyVisible):(this._visible[f]=b,this._fullyVisible=d);const h=this.getState(u);h&&U(u,re,h)}}},this._win=e.getWindow,this.visibilityTolerance=(n=s.visibilityTolerance)!==null&&n!==void 0?n:.8,(this._props.trackState||this._props.visibilityAware)&&(this._intersectionObserver=new IntersectionObserver(this._onIntersection,{threshold:[0,.25,.5,.75,1]}),this._observeState()),this._onDispose=i;const a=()=>s.memorizeCurrent?this._current:void 0;e.controlTab||(this.dummyManager=new Rt(this._element,e,a,o))}dispose(){var e;this._onDispose(this),this._intersectionObserver&&(this._intersectionObserver.disconnect(),delete this._intersectionObserver),delete this._current,delete this._fullyVisible,delete this._allElements,delete this._updateQueue,this._unobserve&&(this._unobserve(),delete this._unobserve);const t=this._win();this._setCurrentTimer&&(t.clearTimeout(this._setCurrentTimer),delete this._setCurrentTimer),this._updateTimer&&(t.clearTimeout(this._updateTimer),delete this._updateTimer),(e=this.dummyManager)===null||e===void 0||e.dispose()}setCurrent(e){e?this._current=new L(this._win,e):this._current=void 0,(this._props.trackState||this._props.visibilityAware)&&!this._setCurrentTimer&&(this._setCurrentTimer=this._win().setTimeout(()=>{var t;delete this._setCurrentTimer;const i=[];this._current!==this._prevCurrent&&(i.push(this._current),i.push(this._prevCurrent),this._prevCurrent=this._current);for(const s of i){const o=s==null?void 0:s.get();if(o&&((t=this._allElements)===null||t===void 0?void 0:t.get(o))===this){const n=this._props;if(o&&(n.visibilityAware!==void 0||n.trackState)){const a=this.getState(o);a&&U(o,re,a)}}}}))}getCurrent(){var e;return((e=this._current)===null||e===void 0?void 0:e.get())||null}findNextTabbable(e,t,i,s){var o;const n=this.getElement(),a=n&&((o=e==null?void 0:e.__tabsterDummyContainer)===null||o===void 0?void 0:o.get())===n;if(!n)return null;const c=this._tabster.focusable;let u=null,f;const b=d=>{f=d};return(this._props.tabbable||a||e&&!n.contains(e))&&(u=t?c.findPrev({currentElement:e,container:n,onUncontrolled:b,ignoreUncontrolled:i,ignoreAccessibility:s,useActiveModalizer:!0}):c.findNext({currentElement:e,container:n,onUncontrolled:b,ignoreUncontrolled:i,ignoreAccessibility:s,useActiveModalizer:!0})),{element:u,uncontrolled:f,lastMoverOrGroupper:u||f?void 0:this}}acceptElement(e,t){var i,s,o;if(!M.isTabbing)return!((i=t.currentCtx)===null||i===void 0)&&i.isExcludedFromMover?NodeFilter.FILTER_REJECT:void 0;const{memorizeCurrent:n,visibilityAware:a,hasDefault:r}=this._props,c=this.getElement();if(c&&(n||a||r)&&(!c.contains(t.from)||((s=t.from.__tabsterDummyContainer)===null||s===void 0?void 0:s.get())===c)){let u;if(n){const f=(o=this._current)===null||o===void 0?void 0:o.get();f&&t.acceptCondition(f)&&(u=f)}if(!u&&r&&(u=this._tabster.focusable.findDefault({container:c,ignoreUncontrolled:!0,useActiveModalizer:!0})),!u&&a&&(u=this._tabster.focusable.findElement({container:c,ignoreUncontrolled:!0,useActiveModalizer:!0,isBackward:t.isBackward,acceptCondition:f=>{var b;const d=K(this._win,f),h=this._visible[d];return c!==f&&!!(!((b=this._allElements)===null||b===void 0)&&b.get(f))&&t.acceptCondition(f)&&(h===z.Visible||h===z.PartiallyVisible&&(a===z.PartiallyVisible||!this._fullyVisible))}})),u)return t.found=!0,t.foundElement=u,t.lastToIgnore=c,NodeFilter.FILTER_ACCEPT}}_observeState(){const e=this.getElement();if(this._unobserve||!e||typeof MutationObserver>"u")return;const t=this._win(),i=this._allElements=new WeakMap,s=this._tabster.focusable;let o=this._updateQueue=[];const n=new MutationObserver(d=>{for(const h of d){const _=h.target,m=h.removedNodes,g=h.addedNodes;if(h.type==="attributes")h.attributeName==="tabindex"&&o.push({element:_,type:Ie});else{for(let v=0;v<m.length;v++)o.push({element:m[v],type:De});for(let v=0;v<g.length;v++)o.push({element:g[v],type:ne})}}f()}),a=(d,h)=>{var _,m;const g=i.get(d);g&&h&&((_=this._intersectionObserver)===null||_===void 0||_.unobserve(d),i.delete(d)),!g&&!h&&(i.set(d,this),(m=this._intersectionObserver)===null||m===void 0||m.observe(d))},r=d=>{const h=s.isFocusable(d);i.get(d)?h||a(d,!0):h&&a(d)},c=d=>{const{mover:h}=b(d);if(h&&h!==this)if(h.getElement()===d&&s.isFocusable(d))a(d);else return;const _=ce(t.document,d,m=>{const{mover:g,groupper:v}=b(m);if(g&&g!==this)return NodeFilter.FILTER_REJECT;const E=v==null?void 0:v.getFirst(!0);return v&&v.getElement()!==m&&E&&E!==m?NodeFilter.FILTER_REJECT:(s.isFocusable(m)&&a(m),NodeFilter.FILTER_SKIP)});if(_)for(_.currentNode=d;_.nextNode(););},u=d=>{i.get(d)&&a(d,!0);for(let _=d.firstElementChild;_;_=_.nextElementSibling)u(_)},f=()=>{!this._updateTimer&&o.length&&(this._updateTimer=t.setTimeout(()=>{delete this._updateTimer;for(const{element:d,type:h}of o)switch(h){case Ie:r(d);break;case ne:c(d);break;case De:u(d);break}o=this._updateQueue=[]},0))},b=d=>{const h={};for(let _=d;_;_=_.parentElement){const m=k(this._tabster,_);if(m&&(m.groupper&&!h.groupper&&(h.groupper=m.groupper),m.mover)){h.mover=m.mover;break}}return h};o.push({element:e,type:ne}),f(),n.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["tabindex"]}),this._unobserve=()=>{n.disconnect()}}getState(e){const t=K(this._win,e);if(t in this._visible){const i=this._visible[t]||z.Invisible;return{isCurrent:this._current?this._current.get()===e:void 0,visibility:i}}}}function Mt(l,e,t,i,s,o,n,a){const r=t<s?s-t:n<l?l-n:0,c=i<o?o-i:a<e?e-a:0;return r===0?c:c===0?r:Math.sqrt(r*r+c*c)}class Ot{constructor(e,t){this._init=()=>{this._win().addEventListener("keydown",this._onKeyDown,!0),this._tabster.focusedElement.subscribe(this._onFocus)},this._onMoverDispose=i=>{delete this._movers[i.id]},this._onFocus=i=>{var s;for(let o=i;o;o=o.parentElement){const n=(s=k(this._tabster,o))===null||s===void 0?void 0:s.mover;if(n){n.setCurrent(i);break}}},this._onKeyDown=async i=>{var s,o,n,a;this._ignoredInputTimer&&(this._win().clearTimeout(this._ignoredInputTimer),delete this._ignoredInputTimer),(s=this._ignoredInputResolve)===null||s===void 0||s.call(this,!1);let r=i.keyCode;if(i.ctrlKey)return;switch(r){case I.Down:case I.Right:case I.Up:case I.Left:case I.PageDown:case I.PageUp:case I.Home:case I.End:break;default:return}const c=this._tabster,u=c.focusedElement.getFocusedElement();if(!u||await this._isIgnoredInput(u,r))return;const f=C.getTabsterContext(c,u,{checkRtl:!0});if(!f||!f.mover||f.isExcludedFromMover||f.ignoreKeydown(i))return;const b=f.mover,d=b.getElement();if(f.isGroupperFirst){const T=f.groupper;if(T&&!T.isActive(!0)){for(let D=(o=T.getElement())===null||o===void 0?void 0:o.parentElement;D&&D!==d;D=D.parentElement)if(!((a=(n=k(c,D))===null||n===void 0?void 0:n.groupper)===null||a===void 0)&&a.isActive(!0))return}else return}if(!d)return;const h=c.focusable,_=b.getProps(),m=_.direction||B.Both,g=m===B.Both,v=g||m===B.Vertical,E=g||m===B.Horizontal,y=m===B.Grid,w=_.cyclic;let p,F,R=0,O=0;if(y&&(F=u.getBoundingClientRect(),R=Math.ceil(F.left),O=Math.floor(F.right)),f.isRtl&&(r===I.Right?r=I.Left:r===I.Left&&(r=I.Right)),r===I.Down&&v||r===I.Right&&(E||y))if(p=h.findNext({currentElement:u,container:d,useActiveModalizer:!0}),p&&y){const T=Math.ceil(p.getBoundingClientRect().left);O>T&&(p=void 0)}else!p&&w&&(p=h.findFirst({container:d,ignoreUncontrolled:!0,useActiveModalizer:!0}));else if(r===I.Up&&v||r===I.Left&&(E||y))p=h.findPrev({currentElement:u,container:d,useActiveModalizer:!0}),p&&y?Math.floor(p.getBoundingClientRect().right)>R&&(p=void 0):!p&&w&&(p=h.findLast({container:d,ignoreUncontrolled:!0,useActiveModalizer:!0}));else if(r===I.Home)y?h.findElement({container:d,currentElement:u,ignoreUncontrolled:!0,useActiveModalizer:!0,isBackward:!0,acceptCondition:T=>{var D;if(!h.isFocusable(T))return!1;const x=Math.ceil((D=T.getBoundingClientRect().left)!==null&&D!==void 0?D:0);return T!==u&&R<=x?!0:(p=T,!1)}}):p=h.findFirst({container:d,ignoreUncontrolled:!0,useActiveModalizer:!0});else if(r===I.End)y?h.findElement({container:d,currentElement:u,ignoreUncontrolled:!0,useActiveModalizer:!0,acceptCondition:T=>{var D;if(!h.isFocusable(T))return!1;const x=Math.ceil((D=T.getBoundingClientRect().left)!==null&&D!==void 0?D:0);return T!==u&&R>=x?!0:(p=T,!1)}}):p=h.findLast({container:d,ignoreUncontrolled:!0,useActiveModalizer:!0});else if(r===I.PageUp){if(h.findElement({currentElement:u,container:d,useActiveModalizer:!0,isBackward:!0,acceptCondition:T=>h.isFocusable(T)?pe(this._win,T,b.visibilityTolerance)?(p=T,!1):!0:!1}),y&&p){const T=Math.ceil(p.getBoundingClientRect().left);h.findElement({currentElement:p,container:d,useActiveModalizer:!0,acceptCondition:D=>{if(!h.isFocusable(D))return!1;const x=Math.ceil(D.getBoundingClientRect().left);return R<x||T>=x?!0:(p=D,!1)}})}p&&ge(this._win,p,!1)}else if(r===I.PageDown){if(h.findElement({currentElement:u,container:d,useActiveModalizer:!0,acceptCondition:T=>h.isFocusable(T)?pe(this._win,T,b.visibilityTolerance)?(p=T,!1):!0:!1}),y&&p){const T=Math.ceil(p.getBoundingClientRect().left);h.findElement({currentElement:p,container:d,useActiveModalizer:!0,isBackward:!0,acceptCondition:D=>{if(!h.isFocusable(D))return!1;const x=Math.ceil(D.getBoundingClientRect().left);return R>x||T<=x?!0:(p=D,!1)}})}p&&ge(this._win,p,!0)}else if(y){const T=r===I.Up,D=R,x=Math.ceil(F.top),X=O,fe=Math.floor(F.bottom);let q,$,j=0;h.findAll({container:d,currentElement:u,isBackward:T,onElement:Y=>{const G=Y.getBoundingClientRect(),Z=Math.ceil(G.left),he=Math.ceil(G.top),ee=Math.floor(G.right),_e=Math.floor(G.bottom);if(T&&x<_e||!T&&fe>he)return!0;const te=Math.ceil(Math.min(X,ee))-Math.floor(Math.max(D,Z)),me=Math.ceil(Math.min(X-D,ee-Z));if(te>0&&me>=te){const V=te/me;V>j&&(q=Y,j=V)}else if(j===0){const V=Mt(D,x,X,fe,Z,he,ee,_e);($===void 0||V<$)&&($=V,q=Y)}else if(j>0)return!1;return!0}}),p=q}p&&(i.preventDefault(),i.stopImmediatePropagation(),P(p))},this._tabster=e,this._win=t,this._movers={},e.queueInit(this._init)}dispose(){var e;const t=this._win();this._tabster.focusedElement.unsubscribe(this._onFocus),(e=this._ignoredInputResolve)===null||e===void 0||e.call(this,!1),this._ignoredInputTimer&&(t.clearTimeout(this._ignoredInputTimer),delete this._ignoredInputTimer),t.removeEventListener("keydown",this._onKeyDown,!0),Object.keys(this._movers).forEach(i=>{this._movers[i]&&(this._movers[i].dispose(),delete this._movers[i])})}createMover(e,t,i){const s=new Ct(this._tabster,e,this._onMoverDispose,t,i);return this._movers[s.id]=s,s}async _isIgnoredInput(e,t){var i;if(e.getAttribute("aria-expanded")==="true")return!0;if(Ve(e,Dt)){let s=0,o=0,n=0,a;if(e.tagName==="INPUT"||e.tagName==="TEXTAREA"){const r=e.type;if(n=(e.value||"").length,r==="email"||r==="number"){if(n){const u=(i=e.ownerDocument.defaultView)===null||i===void 0?void 0:i.getSelection();if(u){const f=u.toString().length,b=t===I.Left||t===I.Up;if(u.modify("extend",b?"backward":"forward","character"),f!==u.toString().length)return u.modify("extend",b?"forward":"backward","character"),!0;n=0}}}else{const u=e.selectionStart;if(u===null)return r==="hidden";s=u||0,o=e.selectionEnd||0}}else e.contentEditable==="true"&&(a=new(Ke(this._win))(r=>{this._ignoredInputResolve=h=>{delete this._ignoredInputResolve,r(h)};const c=this._win();this._ignoredInputTimer&&c.clearTimeout(this._ignoredInputTimer);const{anchorNode:u,focusNode:f,anchorOffset:b,focusOffset:d}=c.getSelection()||{};this._ignoredInputTimer=c.setTimeout(()=>{var h,_,m;delete this._ignoredInputTimer;const{anchorNode:g,focusNode:v,anchorOffset:E,focusOffset:y}=c.getSelection()||{};if(g!==u||v!==f||E!==b||y!==d){(h=this._ignoredInputResolve)===null||h===void 0||h.call(this,!1);return}if(s=E||0,o=y||0,n=((_=e.textContent)===null||_===void 0?void 0:_.length)||0,g&&v&&e.contains(g)&&e.contains(v)&&g!==e){let w=!1;const p=F=>{if(F===g)w=!0;else if(F===v)return!0;const R=F.textContent;if(R&&!F.firstChild){const T=R.length;w?v!==g&&(o+=T):(s+=T,o+=T)}let O=!1;for(let T=F.firstChild;T&&!O;T=T.nextSibling)O=p(T);return O};p(e)}(m=this._ignoredInputResolve)===null||m===void 0||m.call(this,!0)},0)}));if(a&&!await a||s!==o||s>0&&(t===I.Left||t===I.Up||t===I.Home)||s<n&&(t===I.Right||t===I.Down||t===I.End))return!0}return!1}}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */function kt(l,e,t,i){if(typeof MutationObserver>"u")return()=>{};const s=e.getWindow;let o;const n=u=>{var f,b,d,h,_;for(const m of u){const g=m.target,v=m.removedNodes,E=m.addedNodes;if(m.type==="attributes")m.attributeName===N&&t(e,g);else{for(let y=0;y<v.length;y++)a(v[y],!0),(b=(f=e._dummyObserver).domChanged)===null||b===void 0||b.call(f,g);for(let y=0;y<E.length;y++)a(E[y]),(h=(d=e._dummyObserver).domChanged)===null||h===void 0||h.call(d,g)}}(_=e.modalizer)===null||_===void 0||_.hiddenUpdate()};function a(u,f){o||(o=W(s).elementByUId),r(u,f);const b=ce(l,u,d=>r(d,f));if(b)for(;b.nextNode(););}function r(u,f){var b;if(!u.getAttribute)return NodeFilter.FILTER_SKIP;const d=u.__tabsterElementUID;return d&&o&&(f?delete o[d]:(b=o[d])!==null&&b!==void 0||(o[d]=new L(s,u))),(k(e,u)||u.hasAttribute(N))&&t(e,u,f),NodeFilter.FILTER_SKIP}const c=new MutationObserver(n);return i&&a(s().document.body),c.observe(l,{childList:!0,subtree:!0,attributes:!0,attributeFilter:[N]}),()=>{c.disconnect()}}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */class xt{constructor(){}}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */class At{constructor(e){this.keyboardNavigation=e.keyboardNavigation,this.focusedElement=e.focusedElement,this.focusable=e.focusable,this.root=e.root,this.uncontrolled=e.uncontrolled,this.core=e}}class zt{constructor(e,t){var i;this._forgetMemorizedElements=[],this._wrappers=new Set,this._initQueue=[],this._version="4.3.0",this._noop=!1,this.getWindow=()=>{if(!this._win)throw new Error("Using disposed Tabster.");return this._win},this._storage=tt(e),this._win=e;const s=this.getWindow;this.keyboardNavigation=new yt(s),this.focusedElement=new M(this,s),this.focusable=new Et(this),this.root=new C(this,t==null?void 0:t.autoRoot),this.uncontrolled=new xt,this.controlTab=(i=t==null?void 0:t.controlTab)!==null&&i!==void 0?i:!0,this.rootDummyInputs=!!(t!=null&&t.rootDummyInputs),this._dummyObserver=new at(s),this.internal={stopObserver:()=>{this._unobserve&&(this._unobserve(),delete this._unobserve)},resumeObserver:o=>{if(!this._unobserve){const n=s().document;this._unobserve=kt(n,this,Ne,o)}}},Le(s),this.queueInit(()=>{this.internal.resumeObserver(!0)})}createTabster(e){const t=new At(this);return e||this._wrappers.add(t),t}disposeTabster(e,t){t?this._wrappers.clear():this._wrappers.delete(e),this._wrappers.size===0&&this.dispose()}dispose(){var e,t,i,s,o,n,a;this.internal.stopObserver();const r=this._win;r==null||r.clearTimeout(this._initTimer),delete this._initTimer,this._initQueue=[],this._forgetMemorizedElements=[],r&&this._forgetMemorizedTimer&&(r.clearTimeout(this._forgetMemorizedTimer),delete this._forgetMemorizedTimer),(e=this.outline)===null||e===void 0||e.dispose(),(t=this.crossOrigin)===null||t===void 0||t.dispose(),(i=this.deloser)===null||i===void 0||i.dispose(),(s=this.groupper)===null||s===void 0||s.dispose(),(o=this.mover)===null||o===void 0||o.dispose(),(n=this.modalizer)===null||n===void 0||n.dispose(),(a=this.observedElement)===null||a===void 0||a.dispose(),this.keyboardNavigation.dispose(),this.focusable.dispose(),this.focusedElement.dispose(),this.root.dispose(),this._dummyObserver.dispose(),it(this.getWindow),Ee(this.getWindow),this._storage=new WeakMap,this._wrappers.clear(),r&&(et(r),delete r.__tabsterInstance,delete this._win)}storageEntry(e,t){const i=this._storage;let s=i.get(e);return s?t===!1&&Object.keys(s).length===0&&i.delete(e):t===!0&&(s={},i.set(e,s)),s}forceCleanup(){this._win&&(this._forgetMemorizedElements.push(this._win.document.body),!this._forgetMemorizedTimer&&(this._forgetMemorizedTimer=this._win.setTimeout(()=>{delete this._forgetMemorizedTimer;for(let e=this._forgetMemorizedElements.shift();e;e=this._forgetMemorizedElements.shift())Ee(this.getWindow,e),M.forgetMemorized(this.focusedElement,e)},0),We(this.getWindow,!0)))}queueInit(e){var t;this._win&&(this._initQueue.push(e),this._initTimer||(this._initTimer=(t=this._win)===null||t===void 0?void 0:t.setTimeout(()=>{delete this._initTimer,this.drainInitQueue()},0)))}drainInitQueue(){if(!this._win)return;const e=this._initQueue;this._initQueue=[],e.forEach(t=>t())}}function Lt(l,e){let t=Nt(l);return t||(t=new zt(l,e),l.__tabsterInstance=t),t.createTabster()}function Ut(l){const e=l.core;return e.mover||(e.mover=new Ot(e,e.getWindow)),e.mover}function St(l,e){const t=l.core;return t.deloser||(t.deloser=new He(t,e)),t.deloser}function Bt(l){const e=l.core;return e.modalizer||(e.modalizer=new It(e)),e.modalizer}function Vt(l,e){l.core.disposeTabster(l,e)}function Nt(l){return l.__tabsterInstance}export{Wt as T,Ut as a,Bt as b,Lt as c,Vt as d,St as e,ut as g};
//# sourceMappingURL=tabster-dacef0e4.js.map

import{j as me,r as u,a as Ie}from"./react-a9b6c34a.js";import{a as Ee,c as qe}from"./react-dom-a06df840.js";import{L as Be,N as ie,H as Me}from"./react-router-dom-e5f3a2d5.js";import{O as ze,d as De,e as J}from"./react-router-0030e45b.js";import{S as Ce,A as fe,a as $e,R as X,b as Qe,C as Oe,c as Fe}from"./microsoft-cognitiveservices-speech-sdk-6e793f52.js";import{p as Se}from"./dompurify-76a5efca.js";import{S as je,a as T,I as ce,E as He,P as Ge,T as j,B as Ue,b as Ke,c as Ve,d as le,e as We,f as ve,g as Je,h as ye,D as be,C as Xe,i as Ne,j as W,k as Ye,l as Ze,m as et,n as tt}from"./@fluentui-b922d453.js";import{J as nt,i as ot}from"./@react-spring-3be8f457.js";import"./bent-d4cce1f4.js";import"./@remix-run-88f74c5a.js";import"./uuid-a960c1f4.js";import"./tslib-14a4c710.js";import"./@microsoft-31b40247.js";import"./@griffel-cbe60fd0.js";import"./rtl-css-js-4ed993c7.js";import"./@emotion-8a8e73f6.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const p of s.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function a(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=a(n);fetch(n.href,s)}})();const he=me.Fragment,e=me.jsx,h=me.jsxs;const at="/assets/github-fab00c2d.svg",st="_layout_o4bzc_1",rt="_header_o4bzc_13",it="_headerContainer_o4bzc_23",ct="_headerTitleContainer_o4bzc_39",lt="_headerLogo_o4bzc_55",dt="_headerTitle_o4bzc_39",ut="_headerNavList_o4bzc_73",ht="_headerNavPageLink_o4bzc_85",pt="_headerNavPageLinkActive_o4bzc_113",mt="_headerNavLeftMargin_o4bzc_123",gt="_headerRightText_o4bzc_131",_t="_microsoftLogo_o4bzc_141",Ct="_githubLogo_o4bzc_151",y={layout:st,header:rt,headerContainer:it,headerTitleContainer:ct,headerLogo:lt,headerTitle:dt,headerNavList:ut,headerNavPageLink:ht,headerNavPageLinkActive:pt,headerNavLeftMargin:mt,headerRightText:gt,microsoftLogo:_t,githubLogo:Ct},ft=()=>h("div",{className:y.layout,children:[e("header",{className:y.header,role:"banner",children:h("div",{className:y.headerContainer,children:[e(Be,{to:"/",className:y.headerTitleContainer,children:e("h3",{className:y.headerTitle,children:"GPT + Enterprise data | Sample"})}),e("nav",{children:h("ul",{className:y.headerNavList,children:[e("li",{children:e(ie,{to:"/",className:({isActive:t})=>t?y.headerNavPageLinkActive:y.headerNavPageLink,children:"Chat"})}),e("li",{className:y.headerNavLeftMargin,children:e(ie,{to:"/qa",className:({isActive:t})=>t?y.headerNavPageLinkActive:y.headerNavPageLink,children:"Ask a question"})}),e("li",{className:y.headerNavLeftMargin,children:e(ie,{to:"/files",className:({isActive:t})=>t?y.headerNavPageLinkActive:y.headerNavPageLink,children:"Files Viewer"})}),e("li",{className:y.headerNavLeftMargin,children:e("a",{href:"https://aka.ms/entgptsearch",target:"_blank",title:"Github repository link",children:e("img",{src:at,alt:"Github logo","aria-label":"Link to github repository",width:"20px",height:"20px",className:y.githubLogo})})})]})}),e("h4",{className:y.headerRightText,children:"Azure OpenAI + Cognitive Search"})]})}),e(ze,{})]}),St=()=>e("h1",{children:"404"}),vt="_oneshotContainer_1x7b2_1",yt="_oneshotTopSection_1x7b2_15",bt="_oneshotBottomSection_1x7b2_29",Nt="_oneshotTitle_1x7b2_49",Tt="_oneshotQuestionInput_1x7b2_77",kt="_oneshotAnswerContainer_1x7b2_91",wt="_oneshotAnalysisPanel_1x7b2_105",xt="_oneshotSettingsSeparator_1x7b2_115",Rt="_settingsButton_1x7b2_123",b={oneshotContainer:vt,oneshotTopSection:yt,oneshotBottomSection:bt,oneshotTitle:Nt,oneshotQuestionInput:Tt,oneshotAnswerContainer:kt,oneshotAnalysisPanel:wt,oneshotSettingsSeparator:xt,settingsButton:Rt};async function At(t){var i,n,s,p,S,r,C,l;const o=await fetch("/ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:t.question,approach:t.approach,overrides:{semantic_ranker:(i=t.overrides)==null?void 0:i.semanticRanker,semantic_captions:(n=t.overrides)==null?void 0:n.semanticCaptions,top:(s=t.overrides)==null?void 0:s.top,temperature:(p=t.overrides)==null?void 0:p.temperature,prompt_template:(S=t.overrides)==null?void 0:S.promptTemplate,prompt_template_prefix:(r=t.overrides)==null?void 0:r.promptTemplatePrefix,prompt_template_suffix:(C=t.overrides)==null?void 0:C.promptTemplateSuffix,exclude_category:(l=t.overrides)==null?void 0:l.excludeCategory}})}),a=await o.json();if(o.status>299||!o.ok)throw Error(a.error||"Unknown error");return a}async function Lt(t){var i,n,s,p,S,r,C,l,m;const o=await fetch("/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({history:t.history,approach:t.approach,overrides:{semantic_ranker:(i=t.overrides)==null?void 0:i.semanticRanker,semantic_captions:(n=t.overrides)==null?void 0:n.semanticCaptions,top:(s=t.overrides)==null?void 0:s.top,temperature:(p=t.overrides)==null?void 0:p.temperature,prompt_template:(S=t.overrides)==null?void 0:S.promptTemplate,prompt_template_prefix:(r=t.overrides)==null?void 0:r.promptTemplatePrefix,prompt_template_suffix:(C=t.overrides)==null?void 0:C.promptTemplateSuffix,exclude_category:(l=t.overrides)==null?void 0:l.excludeCategory,suggest_followup_questions:(m=t.overrides)==null?void 0:m.suggestFollowupQuestions}})}),a=await o.json();if(o.status>299||!o.ok)throw Error(a.error||"Unknown error");return a}async function Pt(t){const o="e985cb0392ad45d59681a396b208ebcf",a="southcentralus";var i=Ce.fromSubscription(o,a);const n=fe.fromDefaultSpeakerOutput();i.speechSynthesisVoiceName="zh-CN-YunxiNeural";const s=new $e(i,n),S=t.answer.replace(/\[[^\]]*\]/g,"");console.log(t.answer),s.speakTextAsync(S,function(r){r.reason===X.SynthesizingAudioCompleted?console.log("synthesis finished."):console.error("Speech synthesis canceled, "+r.errorDetails+`
Did you set the speech resource key and region values?`),s.close()},function(r){console.trace("err - "+r),s.close()})}function It(t){return`/content/${t}`}var I=(t=>(t.RetrieveThenRead="rtr",t.ReadRetrieveRead="rrr",t.ReadDecomposeAsk="rda",t))(I||{});const Et="_answerContainer_1tryd_1",qt="_answerLogo_1tryd_17",Bt="_answerText_1tryd_25",Mt="_selected_1tryd_43",zt="_citationLearnMore_1tryd_51",Dt="_citation_1tryd_51",$t="_followupQuestionsList_1tryd_95",Qt="_followupQuestionLearnMore_1tryd_103",Ot="_followupQuestion_1tryd_95",Ft="_supContainer_1tryd_141",jt="_retryButton_1tryd_199",Ht="_loadingdots_1tryd_243",Gt="_loading_1tryd_243",N={answerContainer:Et,answerLogo:qt,answerText:Bt,selected:Mt,citationLearnMore:zt,citation:Dt,followupQuestionsList:$t,followupQuestionLearnMore:Qt,followupQuestion:Ot,supContainer:Ft,retryButton:jt,loadingdots:Ht,loading:Gt};function Ut(t,o){const a=[],i=[];let n=t.replace(/<<([^>>]+)>>/g,(r,C)=>(i.push(C),""));n=n.trim();const s=n.split(/\[([^\]]+)\]+\(([^\)]+)\)/g);console.log(s);let p=n.match(/\[([^\]]+)\]+\(([^\)]+)\)/g);return console.log(p),p&&p.map((r,C)=>{const l=r.split("]")[0].replace("[",""),m=r.split("]")[1].replace("(","").replace(")","");console.log(l),console.log(m),a.push({id:C,name:l,path:m})}),{answerHtml:s.map((r,C)=>{if(C%3===0)return r;if(C%3==1){let l=a.find(q=>q.name==r),m=l?l.id:-1;m!==-1?m=l?l.id+1:-1:m=a.length;const v=It(r);return Ee(e("a",{className:"supContainer",title:r,onClick:()=>o(v),children:e("sup",{children:m})}))}else return""}).join(""),citations:a,followupQuestions:i}}const Te=()=>e(je,{primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Answer logo"}),ke=({answer:t,isSelected:o,onCitationClicked:a,onThoughtProcessClicked:i,onSupportingContentClicked:n,onFollowupQuestionClicked:s,onReadAnswerClicked:p,showFollowupQuestions:S})=>{const r=u.useMemo(()=>Ut(t.answer,a),[t]),C=Se.sanitize(r.answerHtml);return h(T,{className:`${N.answerContainer} ${o&&N.selected}`,verticalAlign:"space-between",children:[e(T.Item,{children:h(T,{horizontal:!0,horizontalAlign:"space-between",children:[e(Te,{}),h("div",{children:[e(ce,{style:{color:"black"},iconProps:{iconName:"Lightbulb"},title:"Show thought process",ariaLabel:"Show thought process",onClick:()=>i(),disabled:!t.thoughts}),e(ce,{style:{color:"black"},iconProps:{iconName:"ClipboardList"},title:"Show supporting content",ariaLabel:"Show supporting content",onClick:()=>n(),disabled:!t.data_points.length}),e(ce,{style:{color:"black"},iconProps:{iconName:"ReadOutLoud"},title:"Read answer",ariaLabel:"Read answer",onClick:()=>p(),disabled:!t.answer})]})]})}),e(T.Item,{grow:!0,children:e("div",{className:N.answerText,dangerouslySetInnerHTML:{__html:C}})}),!!r.citations.length&&e(T.Item,{children:h(T,{horizontal:!0,wrap:!0,tokens:{childrenGap:5},children:[e("span",{className:N.citationLearnMore,children:"来源:"}),r.citations.map((l,m)=>{const v=l.path;return e("a",{className:N.citation,title:l.name,onClick:()=>a(v),children:`${++m}. ${l.name}`},m)})]})}),!!r.followupQuestions.length&&S&&s&&e(T.Item,{children:h(T,{horizontal:!0,wrap:!0,className:`${r.citations.length?N.followupQuestionsList:""}`,tokens:{childrenGap:6},children:[e("span",{className:N.followupQuestionLearnMore,children:"您可能还想问:"}),r.followupQuestions.map((l,m)=>e("a",{className:N.followupQuestion,title:l,onClick:()=>s(l),children:`${l}`},m))]})})]})},Kt=()=>{const t=nt({from:{opacity:0},to:{opacity:1}});return e(ot.div,{style:{...t},children:h(T,{className:N.answerContainer,verticalAlign:"space-between",children:[e(Te,{}),e(T.Item,{grow:!0,children:h("p",{className:N.answerText,children:["正在生成回答",e("span",{className:N.loadingdots})]})})]})})},we=({error:t,onRetry:o})=>h(T,{className:N.answerContainer,verticalAlign:"space-between",children:[e(He,{"aria-hidden":"true","aria-label":"Error icon",primaryFill:"red"}),e(T.Item,{grow:!0,children:e("p",{className:N.answerText,children:t})}),e(Ge,{className:N.retryButton,onClick:o,text:"Retry"})]}),Vt="_questionInputContainer_wokwf_1",Wt="_questionInputTextArea_wokwf_19",Jt="_questionInputButtonsContainer_wokwf_29",Xt="_questionInputSendButton_wokwf_41",Yt="_questionInputSendButtonDisabled_wokwf_49",F={questionInputContainer:Vt,questionInputTextArea:Wt,questionInputButtonsContainer:Jt,questionInputSendButton:Xt,questionInputSendButtonDisabled:Yt},xe=({onSend:t,disabled:o,placeholder:a,clearOnSend:i})=>{const[n,s]=u.useState(""),p=()=>{if(o||!n.trim()){console.log("send disabled"),console.log("question: "+n);return}t(n),i&&s("")},S=()=>{const m="e985cb0392ad45d59681a396b208ebcf",v="southcentralus";var q=Ce.fromSubscription(m,v);const k=fe.fromDefaultMicrophoneInput();q.speechRecognitionLanguage="zh-CN";const $=new Qe(q,k);$.recognizeOnceAsync(w=>{switch(w.reason){case X.RecognizedSpeech:console.log(`RECOGNIZED: Text=${w.text}`),s(w.text);break;case X.NoMatch:console.log("NOMATCH: Speech could not be recognized.");break;case X.Canceled:const L=Oe.fromResult(w);console.log(`CANCELED: Reason=${L.reason}`),L.reason==Fe.Error&&(console.log(`CANCELED: ErrorCode=${L.ErrorCode}`),console.log(`CANCELED: ErrorDetails=${L.errorDetails}`),console.log("CANCELED: Did you set the speech resource key and region values?"));break}$.close()})},r=m=>{m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),p())},C=(m,v)=>{v?v.length<=1e3&&s(v):s("")},l=o||!n.trim();return h(T,{horizontal:!0,className:F.questionInputContainer,children:[e(j,{className:F.questionInputTextArea,placeholder:a,multiline:!0,resizable:!1,borderless:!0,value:n,onChange:C,onKeyDown:r}),h("div",{className:F.questionInputButtonsContainer,children:[e("div",{className:`${F.questionInputSendButton} ${l?F.questionInputSendButtonDisabled:""}`,"aria-label":"语音输入",onClick:S,children:e(Ue,{primaryFill:"rgba(115, 118, 225, 1)"})}),e("div",{className:`${F.questionInputSendButton} ${l?F.questionInputSendButtonDisabled:""}`,"aria-label":"提问按钮",onClick:p,children:e(Ke,{primaryFill:"rgba(115, 118, 225, 1)"})})]})]})},Zt="_examplesNavList_v5q0z_1",en="_example_v5q0z_1",tn="_exampleText_v5q0z_53",pe={examplesNavList:Zt,example:en,exampleText:tn},nn=({text:t,value:o,onClick:a})=>e("div",{className:pe.example,onClick:()=>a(o),children:e("p",{className:pe.exampleText,children:t})}),on=[{text:"正常DMS计算公式是什么?",value:"正常DMS计算公式是什么?"},{text:"进货未销定义是什么?",value:"进货未销定义?"},{text:"APP与OSPC端门店货源查询退货状态不一致 门店商品退货状态系统逻辑?",value:"APP与OSPC端门店货源查询退货状态不一致 门店商品退货状态系统逻辑?"}],Re=({onExampleClicked:t})=>e("ul",{className:pe.examplesNavList,children:on.map((o,a)=>e("li",{children:e(nn,{text:o.text,value:o.value,onClick:t})},a))}),an="_thoughtProcess_exr0t_1",sn={thoughtProcess:an};function rn(t){const o=t.split(": "),a=o[0];var i=o.slice(1).join(": ")?o.slice(1).join(": "):"No content";const n=i.match(/<([^>]+)>/);return i=i.replace(/<([^>]+)>/g,""),{title:a,content:i,url:n?n[1]:""}}const cn="_supportingContentNavList_ekyxv_1",ln="_supportingContentItem_ekyxv_17",dn="_supportingContentItemHeader_ekyxv_41",un="_supportingContentItemText_ekyxv_49",V={supportingContentNavList:cn,supportingContentItem:ln,supportingContentItemHeader:dn,supportingContentItemText:un},hn=({supportingContent:t})=>e("ul",{className:V.supportingContentNavList,children:t.map((o,a)=>{const i=rn(o);return h("li",{className:V.supportingContentItem,children:[e("h4",{className:V.supportingContentItemHeader,children:i.title}),e("p",{className:V.supportingContentItemText,children:i.content}),e("a",{className:V.supportingContentItemText,href:i.url,target:"_blank",children:i.url})]})})});var x=(t=>(t.ThoughtProcessTab="thoughtProcess",t.SupportingContentTab="supportingContent",t.CitationTab="citation",t))(x||{});const de={disabled:!0,style:{color:"grey"}},Ae=({answer:t,activeTab:o,activeCitation:a,citationHeight:i,className:n,onActiveTabChanged:s})=>{const p=!t.thoughts,S=!t.data_points.length,r=!a,C=Se.sanitize(t.thoughts);return h(Ve,{className:n,selectedKey:o,onLinkClick:l=>l&&s(l.props.itemKey),children:[e(le,{itemKey:x.ThoughtProcessTab,headerText:"思维过程",headerButtonProps:p?de:void 0,children:e("div",{className:sn.thoughtProcess,dangerouslySetInnerHTML:{__html:C}})}),e(le,{itemKey:x.SupportingContentTab,headerText:"支持内容",headerButtonProps:S?de:void 0,children:e(hn,{supportingContent:t.data_points})}),e(le,{itemKey:x.CitationTab,headerText:"引用",headerButtonProps:r?de:void 0,children:e("iframe",{title:"引用",src:a,width:"100%",height:i})})]})},pn="_container_1k5c7_1",mn={container:pn},Le=({className:t,onClick:o})=>h("div",{className:`${mn.container} ${t??""}`,onClick:o,children:[e(We,{}),e(ve,{children:"开发人员配置"})]}),gn=()=>{const[t,o]=u.useState(!1),[a,i]=u.useState(I.ReadDecomposeAsk),[n,s]=u.useState(""),[p,S]=u.useState(""),[r,C]=u.useState(""),[l,m]=u.useState(3),[v,q]=u.useState(!1),[k,$]=u.useState(!1),[w,L]=u.useState(""),B=u.useRef(""),[M,G]=u.useState(!1),[z,D]=u.useState(),[R,Q]=u.useState(),[H,E]=u.useState(),[O,P]=u.useState(void 0),U=async g=>{B.current=g,z&&D(void 0),G(!0),E(void 0),P(void 0);try{const _={question:g,approach:a,overrides:{promptTemplate:n.length===0?void 0:n,promptTemplatePrefix:p.length===0?void 0:p,promptTemplateSuffix:r.length===0?void 0:r,excludeCategory:w.length===0?void 0:w,top:l,semanticRanker:v,semanticCaptions:k}},Pe=await At(_);Q(Pe)}catch(_){D(_)}finally{G(!1)}},Y=(g,_)=>{s(_||"")},Z=(g,_)=>{S(_||"")},ee=(g,_)=>{C(_||"")},te=(g,_)=>{m(parseInt(_||"3"))},ne=(g,_)=>{i((_==null?void 0:_.key)||I.RetrieveThenRead)},oe=(g,_)=>{q(!!_)},ae=(g,_)=>{$(!!_)},se=(g,_)=>{L(_||"")},K=g=>{U(g)},re=g=>{H===g&&O===x.CitationTab?P(void 0):(E(g),P(x.CitationTab))},c=g=>{P(O===g?void 0:g)},d=()=>{alert("onReadAnswerClicked")},A=[{key:I.RetrieveThenRead,text:"Retrieve-Then-Read"},{key:I.ReadRetrieveRead,text:"Read-Retrieve-Read"},{key:I.ReadDecomposeAsk,text:"Read-Decompose-Ask"}];return h("div",{className:b.oneshotContainer,children:[h("div",{className:b.oneshotTopSection,children:[e(Le,{className:b.settingsButton,onClick:()=>o(!t)}),e("h1",{className:b.oneshotTitle,children:"Ask your data"}),e("div",{className:b.oneshotQuestionInput,children:e(xe,{placeholder:"示例:面条是否可以用体外模拟进行GI测试？?",disabled:M,onSend:g=>U(g)})})]}),h("div",{className:b.oneshotBottomSection,children:[M&&e(Je,{label:"正在生成回答"}),!B.current&&e(Re,{onExampleClicked:K}),!M&&R&&!z&&e("div",{className:b.oneshotAnswerContainer,children:e(ke,{answer:R,onCitationClicked:g=>re(g),onThoughtProcessClicked:()=>c(x.ThoughtProcessTab),onSupportingContentClicked:()=>c(x.SupportingContentTab),onReadAnswerClicked:()=>d()})}),z?e("div",{className:b.oneshotAnswerContainer,children:e(we,{error:z.toString(),onRetry:()=>U(B.current)})}):null,O&&R&&e(Ae,{className:b.oneshotAnalysisPanel,activeCitation:H,onActiveTabChanged:g=>c(g),citationHeight:"600px",answer:R,activeTab:O})]}),h(ye,{headerText:"配置",isOpen:t,isBlocking:!1,onDismiss:()=>o(!1),closeButtonAriaLabel:"Close",onRenderFooterContent:()=>e(be,{onClick:()=>o(!1),children:"Close"}),isFooterAtBottom:!0,children:[e(Xe,{className:b.oneshotSettingsSeparator,label:"方式",options:A,defaultSelectedKey:a,onChange:ne}),(a===I.RetrieveThenRead||a===I.ReadDecomposeAsk)&&e(j,{className:b.oneshotSettingsSeparator,defaultValue:n,label:"更改提问模板",multiline:!0,autoAdjustHeight:!0,onChange:Y}),a===I.ReadRetrieveRead&&h(he,{children:[e(j,{className:b.oneshotSettingsSeparator,defaultValue:p,label:"更改提问前缀模板",multiline:!0,autoAdjustHeight:!0,onChange:Z}),e(j,{className:b.oneshotSettingsSeparator,defaultValue:r,label:"更改提问后缀模板",multiline:!0,autoAdjustHeight:!0,onChange:ee})]}),e(Ne,{className:b.oneshotSettingsSeparator,label:"最多从搜索中返回的条目数量:",min:1,max:50,defaultValue:l.toString(),onChange:te}),e(j,{className:b.oneshotSettingsSeparator,label:"排除类别",onChange:se}),e(W,{className:b.oneshotSettingsSeparator,checked:v,label:"使用语义搜索",onChange:oe}),e(W,{className:b.oneshotSettingsSeparator,checked:k,label:"使用查询上下文摘要而不是整个文档",onChange:ae,disabled:!v})]})]})},_n="_container_1qf1y_1",Cn="_chatRoot_1qf1y_15",fn="_chatContainer_1qf1y_25",Sn="_chatEmptyState_1qf1y_41",vn="_chatEmptyStateTitle_1qf1y_61",yn="_chatEmptyStateSubtitle_1qf1y_75",bn="_chatMessageStream_1qf1y_107",Nn="_chatMessageGpt_1qf1y_131",Tn="_chatMessageGptMinWidth_1qf1y_145",kn="_chatInput_1qf1y_155",wn="_chatAnalysisPanel_1qf1y_181",xn="_chatSettingsSeparator_1qf1y_197",Rn="_loadingLogo_1qf1y_205",An="_commandsContainer_1qf1y_213",Ln="_commandButton_1qf1y_223",f={container:_n,chatRoot:Cn,chatContainer:fn,chatEmptyState:Sn,chatEmptyStateTitle:vn,chatEmptyStateSubtitle:yn,chatMessageStream:bn,chatMessageGpt:Nn,chatMessageGptMinWidth:Tn,chatInput:kn,chatAnalysisPanel:wn,chatSettingsSeparator:xn,loadingLogo:Rn,commandsContainer:An,commandButton:Ln},Pn="_container_u4tj7_1",In="_message_u4tj7_17",ge={container:Pn,message:In},ue=({message:t})=>e("div",{className:ge.container,children:e("div",{className:ge.message,children:t})}),En="_container_7708a_1",qn="_disabled_7708a_15",_e={container:En,disabled:qn},Bn=({className:t,disabled:o,onClick:a})=>h("div",{className:`${_e.container} ${t??""} ${o&&_e.disabled}`,onClick:a,children:[e(Ye,{}),e(ve,{children:"清空对话"})]}),Mn=()=>{const[t,o]=u.useState(!1),[a,i]=u.useState(""),[n,s]=u.useState(3),[p,S]=u.useState(!1),[r,C]=u.useState(!1),[l,m]=u.useState(""),[v,q]=u.useState(!0),k=u.useRef(""),$=u.useRef(null),[w,L]=u.useState(!1),[B,M]=u.useState(),[G,z]=u.useState(),[D,R]=u.useState(void 0),[Q,H]=u.useState(0),[E,O]=u.useState([]),P=async c=>{k.current=c,B&&M(void 0),L(!0),z(void 0),R(void 0);try{const A={history:[...E.map(_=>({user:_[0],bot:_[1].answer})),{user:c,bot:void 0}],approach:I.ReadRetrieveRead,overrides:{promptTemplate:a.length===0?void 0:a,excludeCategory:l.length===0?void 0:l,top:n,semanticRanker:p,semanticCaptions:r,suggestFollowupQuestions:v}},g=await Lt(A);O([...E,[c,g]])}catch(d){M(d)}finally{L(!1)}},U=()=>{k.current="",B&&M(void 0),z(void 0),R(void 0),O([])};u.useEffect(()=>{var c;return(c=$.current)==null?void 0:c.scrollIntoView({behavior:"smooth"})},[w]);const Y=(c,d)=>{i(d||"")},Z=(c,d)=>{s(parseInt(d||"3"))},ee=(c,d)=>{S(!!d)},te=(c,d)=>{C(!!d)},ne=(c,d)=>{m(d||"")},oe=(c,d)=>{q(!!d)},ae=c=>{P(c)},se=(c,d)=>{G===c&&D===x.CitationTab&&Q===d?R(void 0):(z(c),R(x.CitationTab)),H(d)},K=(c,d)=>{R(D===c&&Q===d?void 0:c),H(d)},re=async(c,d)=>{H(d);try{const A={answer:c.answer};await Pt(A)}catch(A){M(A)}finally{L(!1)}};return h("div",{className:f.container,children:[h("div",{className:f.commandsContainer,children:[e(Bn,{className:f.commandButton,onClick:U,disabled:!k.current||w}),e(Le,{className:f.commandButton,onClick:()=>o(!t)})]}),h("div",{className:f.chatRoot,children:[h("div",{className:f.chatContainer,children:[k.current?h("div",{className:f.chatMessageStream,children:[E.map((c,d)=>h("div",{children:[e(ue,{message:c[0]}),e("div",{className:f.chatMessageGpt,children:e(ke,{answer:c[1],isSelected:Q===d&&D!==void 0,onCitationClicked:A=>se(A,d),onThoughtProcessClicked:()=>K(x.ThoughtProcessTab,d),onSupportingContentClicked:()=>K(x.SupportingContentTab,d),onFollowupQuestionClicked:A=>P(A),onReadAnswerClicked:()=>re(c[1],d),showFollowupQuestions:v&&E.length-1===d},d)})]},d)),w&&h(he,{children:[e(ue,{message:k.current}),e("div",{className:f.chatMessageGptMinWidth,children:e(Kt,{})})]}),B?h(he,{children:[e(ue,{message:k.current}),e("div",{className:f.chatMessageGptMinWidth,children:e(we,{error:B.toString(),onRetry:()=>P(k.current)})})]}):null,e("div",{ref:$})]}):h("div",{className:f.chatEmptyState,children:[e(Ze,{fontSize:"120px",primaryFill:"rgba(115, 118, 225, 1)","aria-hidden":"true","aria-label":"Chat logo"}),e("h1",{className:f.chatEmptyStateTitle,children:"Chat with your data"}),e("h2",{className:f.chatEmptyStateSubtitle,children:"Ask anything or try an example"}),e(Re,{onExampleClicked:ae})]}),e("div",{className:f.chatInput,children:e(xe,{clearOnSend:!0,placeholder:"输入问题",disabled:w,onSend:c=>P(c)})})]}),E.length>0&&D&&e(Ae,{className:f.chatAnalysisPanel,activeCitation:G,onActiveTabChanged:c=>K(c,Q),citationHeight:"810px",answer:E[Q][1],activeTab:D}),h(ye,{headerText:"配置",isOpen:t,isBlocking:!1,onDismiss:()=>o(!1),closeButtonAriaLabel:"Close",onRenderFooterContent:()=>e(be,{onClick:()=>o(!1),children:"Close"}),isFooterAtBottom:!0,children:[e(j,{className:f.chatSettingsSeparator,defaultValue:a,label:"更改提问模板",multiline:!0,autoAdjustHeight:!0,onChange:Y}),e(Ne,{className:f.chatSettingsSeparator,label:"最多从搜索中返回的条目数量:",min:1,max:50,defaultValue:n.toString(),onChange:Z}),e(j,{className:f.chatSettingsSeparator,label:"排除类别",onChange:ne}),e(W,{className:f.chatSettingsSeparator,checked:p,label:"使用语义搜索",onChange:ee}),e(W,{className:f.chatSettingsSeparator,checked:r,label:"使用查询上下文摘要而不是整个文档",onChange:te,disabled:!p}),e(W,{className:f.chatSettingsSeparator,checked:v,label:"建议后续问题",onChange:oe})]})]})]})};et();tt();function zn(){return e(Me,{children:e(De,{children:h(J,{path:"/",element:e(ft,{}),children:[e(J,{index:!0,element:e(Mn,{})}),e(J,{path:"qa",element:e(gn,{})}),e(J,{path:"*",element:e(St,{})})]})})})}qe.createRoot(document.getElementById("root")).render(e(Ie.StrictMode,{children:e(zn,{})}));
//# sourceMappingURL=index-1bfe9dca.js.map

{"version":3,"file":"upload-js-e5d126b1.js","sources":["../../../frontend/node_modules/upload-js/dist/main.js"],"sourcesContent":["module.exports =\n/******/ (function() { // webpackBootstrap\n/******/ \t\"use strict\";\n/******/ \tvar __webpack_modules__ = ({\n\n/***/ \"./src/index.ts\":\n/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {\n\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n  \"Upload\": function() { return /* reexport */ Upload; },\n  \"UploadApiError\": function() { return /* reexport */ UploadApiError; }\n});\n\n;// CONCATENATED MODULE: external \"@upload-io/upload-api-client-upload-js\"\nvar upload_api_client_upload_js_namespaceObject = require(\"@upload-io/upload-api-client-upload-js\");;\n;// CONCATENATED MODULE: ./src/Mutex.ts\n/**\n * A lightweight mutex. (Other libraries contain too many features and we want to keep the size upload-js down).\n *\n * Characteristics:\n * - Non-reentrant.\n * - Unfair. (Multiple callers awaiting 'acquire' will be granted the mutex in no order.)\n *   - When calling `safe` consecutively with no 'awaits' in-between, the current context will synchronously acquire\n *     the mutex every time.\n */\nfunction _call(body, then, direct) {\n  if (direct) {\n    return then ? then(body()) : body();\n  }\n\n  try {\n    var result = Promise.resolve(body());\n    return then ? result.then(then) : result;\n  } catch (e) {\n    return Promise.reject(e);\n  }\n}\n\nfunction _rethrow(thrown, value) {\n  if (thrown) throw value;\n  return value;\n}\n\nfunction _finallyRethrows(body, finalizer) {\n  try {\n    var result = body();\n  } catch (e) {\n    return finalizer(true, e);\n  }\n\n  if (result && result.then) {\n    return result.then(finalizer.bind(null, false), finalizer.bind(null, true));\n  }\n\n  return finalizer(false, result);\n}\n\nfunction _empty() {}\n\nfunction _awaitIgnored(value, direct) {\n  if (!direct) {\n    return value && value.then ? value.then(_empty) : Promise.resolve();\n  }\n}\n\nfunction _settle(pact, state, value) {\n  if (!pact.s) {\n    if (value instanceof _Pact) {\n      if (value.s) {\n        if (state & 1) {\n          state = value.s;\n        }\n\n        value = value.v;\n      } else {\n        value.o = _settle.bind(null, pact, state);\n        return;\n      }\n    }\n\n    if (value && value.then) {\n      value.then(_settle.bind(null, pact, state), _settle.bind(null, pact, 2));\n      return;\n    }\n\n    pact.s = state;\n    pact.v = value;\n    var observer = pact.o;\n\n    if (observer) {\n      observer(pact);\n    }\n  }\n}\n\nvar _Pact = /*#__PURE__*/function () {\n  function _Pact() {}\n\n  _Pact.prototype.then = function (onFulfilled, onRejected) {\n    var result = new _Pact();\n    var state = this.s;\n\n    if (state) {\n      var callback = state & 1 ? onFulfilled : onRejected;\n\n      if (callback) {\n        try {\n          _settle(result, 1, callback(this.v));\n        } catch (e) {\n          _settle(result, 2, e);\n        }\n\n        return result;\n      } else {\n        return this;\n      }\n    }\n\n    this.o = function (_this) {\n      try {\n        var value = _this.v;\n\n        if (_this.s & 1) {\n          _settle(result, 1, onFulfilled ? onFulfilled(value) : value);\n        } else if (onRejected) {\n          _settle(result, 1, onRejected(value));\n        } else {\n          _settle(result, 2, value);\n        }\n      } catch (e) {\n        _settle(result, 2, e);\n      }\n    };\n\n    return result;\n  };\n\n  return _Pact;\n}();\n\nfunction _isSettledPact(thenable) {\n  return thenable instanceof _Pact && thenable.s & 1;\n}\n\nfunction _for(test, update, body) {\n  var stage;\n\n  for (;;) {\n    var shouldContinue = test();\n\n    if (_isSettledPact(shouldContinue)) {\n      shouldContinue = shouldContinue.v;\n    }\n\n    if (!shouldContinue) {\n      return result;\n    }\n\n    if (shouldContinue.then) {\n      stage = 0;\n      break;\n    }\n\n    var result = body();\n\n    if (result && result.then) {\n      if (_isSettledPact(result)) {\n        result = result.s;\n      } else {\n        stage = 1;\n        break;\n      }\n    }\n\n    if (update) {\n      var updateValue = update();\n\n      if (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n        stage = 2;\n        break;\n      }\n    }\n  }\n\n  var pact = new _Pact();\n\n  var reject = _settle.bind(null, pact, 2);\n\n  (stage === 0 ? shouldContinue.then(_resumeAfterTest) : stage === 1 ? result.then(_resumeAfterBody) : updateValue.then(_resumeAfterUpdate)).then(void 0, reject);\n  return pact;\n\n  function _resumeAfterBody(value) {\n    result = value;\n\n    do {\n      if (update) {\n        updateValue = update();\n\n        if (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n          updateValue.then(_resumeAfterUpdate).then(void 0, reject);\n          return;\n        }\n      }\n\n      shouldContinue = test();\n\n      if (!shouldContinue || _isSettledPact(shouldContinue) && !shouldContinue.v) {\n        _settle(pact, 1, result);\n\n        return;\n      }\n\n      if (shouldContinue.then) {\n        shouldContinue.then(_resumeAfterTest).then(void 0, reject);\n        return;\n      }\n\n      result = body();\n\n      if (_isSettledPact(result)) {\n        result = result.v;\n      }\n    } while (!result || !result.then);\n\n    result.then(_resumeAfterBody).then(void 0, reject);\n  }\n\n  function _resumeAfterTest(shouldContinue) {\n    if (shouldContinue) {\n      result = body();\n\n      if (result && result.then) {\n        result.then(_resumeAfterBody).then(void 0, reject);\n      } else {\n        _resumeAfterBody(result);\n      }\n    } else {\n      _settle(pact, 1, result);\n    }\n  }\n\n  function _resumeAfterUpdate() {\n    if (shouldContinue = test()) {\n      if (shouldContinue.then) {\n        shouldContinue.then(_resumeAfterTest).then(void 0, reject);\n      } else {\n        _resumeAfterTest(shouldContinue);\n      }\n    } else {\n      _settle(pact, 1, result);\n    }\n  }\n}\n\nfunction _continue(value, then) {\n  return value && value.then ? value.then(then) : then(value);\n}\n\nfunction _async(f) {\n  return function () {\n    for (var args = [], i = 0; i < arguments.length; i++) {\n      args[i] = arguments[i];\n    }\n\n    try {\n      return Promise.resolve(f.apply(this, args));\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n}\n\nfunction Mutex() {\n  var mutex;\n  var resolver;\n\n  var safe = function safe(callback) {\n    return _call(acquire, function () {\n      return _finallyRethrows(callback, function (_wasThrown, _result) {\n        release();\n        return _rethrow(_wasThrown, _result);\n      });\n    });\n  };\n\n  var acquire = _async(function () {\n    // Loop necessary for when multiple calls are made to 'acquire' before a 'release' is called, else the call to\n    // 'release' will resume every caller currently waiting on 'acquire'.\n    // eslint-disable-next-line no-unmodified-loop-condition\n    return _continue(_for(function () {\n      return mutex !== undefined;\n    }, void 0, function () {\n      return _awaitIgnored(mutex);\n    }), function () {\n      mutex = new Promise(function (resolve) {\n        resolver = resolve;\n      });\n    });\n  });\n\n  var release = function release() {\n    if (resolver === undefined) {\n      throw new Error(\"Unable to release mutex: already released.\");\n    }\n\n    resolver();\n    resolver = undefined;\n    mutex = undefined;\n  };\n\n  return {\n    safe: safe\n  };\n}\n;// CONCATENATED MODULE: external \"progress-smoother\"\nvar external_progress_smoother_namespaceObject = require(\"progress-smoother\");;\n;// CONCATENATED MODULE: ./src/UploadApiError.ts\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) { return typeof obj; } : function (obj) { return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }, _typeof(obj); }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _wrapNativeSuper(Class) { var _cache = typeof Map === \"function\" ? new Map() : undefined; _wrapNativeSuper = function _wrapNativeSuper(Class) { if (Class === null || !_isNativeFunction(Class)) return Class; if (typeof Class !== \"function\") { throw new TypeError(\"Super expression must either be null or a function\"); } if (typeof _cache !== \"undefined\") { if (_cache.has(Class)) return _cache.get(Class); _cache.set(Class, Wrapper); } function Wrapper() { return _construct(Class, arguments, _getPrototypeOf(this).constructor); } Wrapper.prototype = Object.create(Class.prototype, { constructor: { value: Wrapper, enumerable: false, writable: true, configurable: true } }); return _setPrototypeOf(Wrapper, Class); }; return _wrapNativeSuper(Class); }\n\nfunction _construct(Parent, args, Class) { if (_isNativeReflectConstruct()) { _construct = Reflect.construct; } else { _construct = function _construct(Parent, args, Class) { var a = [null]; a.push.apply(a, args); var Constructor = Function.bind.apply(Parent, a); var instance = new Constructor(); if (Class) _setPrototypeOf(instance, Class.prototype); return instance; }; } return _construct.apply(null, arguments); }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\nfunction _isNativeFunction(fn) { return Function.toString.call(fn).indexOf(\"[native code]\") !== -1; }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nvar UploadApiError = /*#__PURE__*/function (_Error) {\n  _inherits(UploadApiError, _Error);\n\n  var _super = _createSuper(UploadApiError);\n\n  function UploadApiError(response) {\n    var _this;\n\n    _classCallCheck(this, UploadApiError);\n\n    _this = _super.call(this, response.error.message);\n    _this.errorCode = response.error.code;\n    _this.details = response.error.details;\n    return _this;\n  }\n\n  return _createClass(UploadApiError);\n}( /*#__PURE__*/_wrapNativeSuper(Error));\n;// CONCATENATED MODULE: ./src/Upload.ts\nfunction Upload_rethrow(thrown, value) {\n  if (thrown) throw value;\n  return value;\n}\n\nfunction Upload_finallyRethrows(body, finalizer) {\n  try {\n    var result = body();\n  } catch (e) {\n    return finalizer(true, e);\n  }\n\n  if (result && result.then) {\n    return result.then(finalizer.bind(null, false), finalizer.bind(null, true));\n  }\n\n  return finalizer(false, result);\n}\n\nfunction _continueIgnored(value) {\n  if (value && value.then) {\n    return value.then(Upload_empty);\n  }\n}\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\n\n\n\n\n\nfunction Upload_empty() {}\n\nvar accountIdLength = 7; // Sync with: upload/shared/**/AccountIdUtils\n\nfunction Upload_awaitIgnored(value, direct) {\n  if (!direct) {\n    return value && value.then ? value.then(Upload_empty) : Promise.resolve();\n  }\n}\n\nvar specialApiKeyAccountId = \"W142hJk\";\n\nfunction Upload_call(body, then, direct) {\n  if (direct) {\n    return then ? then(body()) : body();\n  }\n\n  try {\n    var result = Promise.resolve(body());\n    return then ? result.then(then) : result;\n  } catch (e) {\n    return Promise.reject(e);\n  }\n}\n\nvar specialApiKeys = [\"free\", \"demo\"];\n\nfunction Upload_async(f) {\n  return function () {\n    for (var args = [], i = 0; i < arguments.length; i++) {\n      args[i] = arguments[i];\n    }\n\n    try {\n      return Promise.resolve(f.apply(this, args));\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  };\n}\n\nvar apiKeyPrefix = \"public_\";\n\nfunction _callIgnored(body, direct) {\n  return Upload_call(body, Upload_empty, direct);\n}\n\nvar maxUploadConcurrency = 5;\n\nfunction _await(value, then, direct) {\n  if (direct) {\n    return then ? then(value) : value;\n  }\n\n  if (!value || !value.then) {\n    value = Promise.resolve(value);\n  }\n\n  return then ? value.then(then) : value;\n}\n\nvar refreshBeforeExpirySeconds = 20;\n\nfunction _catch(body, recover) {\n  try {\n    var result = body();\n  } catch (e) {\n    return recover(e);\n  }\n\n  if (result && result.then) {\n    return result.then(void 0, recover);\n  }\n\n  return result;\n}\n\nvar onProgressInterval = 100;\n\nfunction _invokeIgnored(body) {\n  var result = body();\n\n  if (result && result.then) {\n    return result.then(Upload_empty);\n  }\n}\n\nvar retryAuthAfterErrorSeconds = 5;\nvar accessTokenPathBase = \"/api/v1/access_tokens/\";\nvar logPrefix = \"[upload-js] \";\n/**\n * You should instantiate one instance of this class in your web app.\n *\n * Try using:\n *\n *    Upload({apiKey: \"free\"})\n *\n * This is particularly important when using the 'beginAuthSession' and\n * 'endAuthSession' methods, as you don't want multiple running instances of the\n * auth process in your web application.\n */\n\nfunction Upload(config) {\n  // ----------------\n  // READONLY MEMBERS\n  // ----------------\n  var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n\n  var accountId;\n  var authMutex = Mutex();\n  var apiUrl = (_b = (_a = config.internal) === null || _a === void 0 ? void 0 : _a.apiUrl) !== null && _b !== void 0 ? _b : \"https://api.upload.io\";\n  var cdnUrl = (_d = (_c = config.internal) === null || _c === void 0 ? void 0 : _c.cdnUrl) !== null && _d !== void 0 ? _d : \"https://upcdn.io\";\n  var authenticateWithApiKey = (_f = (_e = config.internal) === null || _e === void 0 ? void 0 : _e.authenticateWithApiKey) !== null && _f !== void 0 ? _f : true;\n  var headers = (_g = config.internal) === null || _g === void 0 ? void 0 : _g.headers;\n  var debugMode = config.debug === true; // ------------------\n  // READ/WRITE MEMBERS\n  // ------------------\n\n  var lastAuthSession; // ----------------\n  // CONSTRUCTOR\n  // ----------------\n\n  if ((config !== null && config !== void 0 ? config : undefined) === undefined) {\n    throw new Error(\"\".concat(logPrefix, \"Config parameter required.\"));\n  }\n\n  if (config.debug === true) {\n    console.log(\"\".concat(logPrefix, \"Initialized with API key '\").concat(config.apiKey, \"'\"));\n  }\n\n  if (((_h = config.apiKey) !== null && _h !== void 0 ? _h : undefined) === undefined) {\n    throw new Error(\"\".concat(logPrefix, \"Please provide an API key via the 'apiKey' config parameter.\"));\n  }\n\n  if (config.apiKey.trim() !== config.apiKey) {\n    // We do not support API keys with whitespace (by trimming ourselves) because otherwise we'd need to support this\n    // everywhere in perpetuity (since removing the trimming would be a breaking change).\n    throw new Error(\"\".concat(logPrefix, \"API key needs trimming (whitespace detected).\"));\n  } // Non-api-key authentication is required by Upload Dashboard, which uses bearer tokens instead of API keys because\n  // the user may not have any active API keys, but might still want to upload files via the Upload Dashboard.\n\n\n  if (((_j = config.internal) === null || _j === void 0 ? void 0 : _j.authenticateWithApiKey) === false) {\n    accountId = config.internal.accountId;\n  } else {\n    if (specialApiKeys.includes(config.apiKey)) {\n      accountId = specialApiKeyAccountId;\n    } else {\n      if (!config.apiKey.startsWith(apiKeyPrefix)) {\n        throw new Error(\"\".concat(logPrefix, \"API key must begin with \\\"\").concat(apiKeyPrefix, \"\\\".\"));\n      }\n\n      accountId = config.apiKey.substr(apiKeyPrefix.length, accountIdLength);\n\n      if (accountId.length !== accountIdLength) {\n        throw new Error(\"\".concat(logPrefix, \"API key is too short!\"));\n      }\n    }\n  }\n\n  var accessTokenPath = \"\".concat(cdnUrl).concat(accessTokenPathBase).concat(accountId); // ----------------\n  // PUBLIC METHODS\n  // ----------------\n\n  var beginAuthSession = function beginAuthSession(authUrl, authHeaders) {\n    return Upload_call(endAuthSession, function () {\n      var authSession = {\n        accessToken: undefined,\n        accessTokenRefreshHandle: undefined,\n        isActive: true\n      }; // Does not need to be inside the mutex since the environment is single-threaded, and we have not async-yielded\n      // since the mutex from 'endAuthSession' was relinquished (meaning we still have execution, so we know a) nothing\n      // can interject and b) nothing has interjected since the lock was relinquished).\n\n      lastAuthSession = authSession;\n      return Upload_awaitIgnored(refreshAccessToken(authUrl, authHeaders, authSession));\n    });\n  };\n\n  var endAuthSession = Upload_async(function () {\n    return Upload_awaitIgnored(authMutex.safe(Upload_async(function () {\n      if (lastAuthSession === undefined) {\n        return;\n      }\n\n      var authSession = lastAuthSession;\n      lastAuthSession = undefined;\n\n      if (authSession.accessTokenRefreshHandle !== undefined) {\n        clearTimeout(authSession.accessTokenRefreshHandle);\n      }\n\n      authSession.isActive = false;\n      return _callIgnored(deleteAccessToken);\n    })));\n  });\n\n  var uploadFile = Upload_async(function (file) {\n    var params = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    // Initial progress (raised immediately and synchronously).\n    var cancellationHandlers = [];\n\n    var addCancellationHandler = function addCancellationHandler(ca) {\n      cancellationHandlers.push(ca);\n    };\n\n    var cancel = function cancel() {\n      return cancellationHandlers.forEach(function (x) {\n        return x();\n      });\n    };\n\n    if (params.onBegin !== undefined) {\n      params.onBegin({\n        cancel: cancel\n      });\n    }\n\n    return _catch(function () {\n      return _await(beginFileUpload(file, params, addCancellationHandler));\n    }, function (e) {\n      cancel();\n      throw e;\n    });\n  });\n\n  var url = function url(filePath, slugOrParams) {\n    var _a;\n\n    var defaultSlug = \"raw\";\n    var params = typeof slugOrParams === \"string\" ? {\n      transformation: slugOrParams\n    } : slugOrParams;\n    return \"\".concat(cdnUrl, \"/\").concat(accountId, \"/\").concat((_a = params === null || params === void 0 ? void 0 : params.transformation) !== null && _a !== void 0 ? _a : defaultSlug).concat(filePath).concat((params === null || params === void 0 ? void 0 : params.auth) === true ? \"?_auth=true\" : \"\");\n  }; // ----------------\n  // PRIVATE METHODS\n  // ----------------\n\n\n  var beginFileUpload = Upload_async(function (file, params, addCancellationHandler) {\n    var progressSmoother = (0,external_progress_smoother_namespaceObject.ProgressSmoother)({\n      maxValue: file.size,\n      teardownTime: 1000,\n      minDelayUntilFirstValue: 2000,\n      valueIncreaseDelta: 200 * 1024,\n      valueIncreaseRatePerSecond: 50 * 1024,\n      averageTimeBetweenValues: 1000 // When running, XHR should (hopefully) report at least every second, regardless of connection speed.\n\n    });\n\n    var reportProgress = function reportProgress(stopReportingProgress) {\n      if (params.onProgress === undefined) {\n        stopReportingProgress(); // Important to call this, as outer function awaits this call when the download ends.\n      } else {\n        var bytesSent = progressSmoother.smoothedValue();\n        var bytesTotal = file.size;\n\n        if (bytesSent === bytesTotal) {\n          stopReportingProgress();\n        }\n\n        params.onProgress({\n          bytesSent: bytesSent,\n          bytesTotal: bytesTotal,\n          progress: Math.round(bytesSent / bytesTotal * 100)\n        });\n      }\n    };\n\n    return withProgressReporting(onProgressInterval, reportProgress, Upload_async(function () {\n      var uploadRequest = {\n        path: params.path,\n        metadata: params.metadata,\n        mime: normalizeMimeType(file.type),\n        originalFileName: file.name,\n        protocol: \"1.1\",\n        size: file.size,\n        tags: params.tags\n      };\n      debug(\"Initiating file upload. Params = \".concat(JSON.stringify(uploadRequest)));\n      return _await((0,upload_api_client_upload_js_namespaceObject.beginMultipartUpload)(getConfig(), accountId, uploadRequest), function (_beginMultipartUpload) {\n        var uploadMetadata = handleApiResult(_beginMultipartUpload);\n        debug(\"Initiated file upload. Metadata = \".concat(JSON.stringify(uploadMetadata)));\n\n        var incUploadIndex = function () {\n          var lastUploadIndex = 0;\n          return function () {\n            if (lastUploadIndex === uploadMetadata.uploadParts.count - 1) {\n              return undefined;\n            }\n\n            return ++lastUploadIndex;\n          };\n        }();\n\n        var nextPartQueue = [uploadMetadata.uploadParts.first];\n\n        var getNextPart = Upload_async(function (workerIndex) {\n          var nextPart = nextPartQueue.pop();\n\n          if (nextPart !== undefined) {\n            debug(\"Dequeued part \".concat(nextPart.uploadPartIndex, \".\"), workerIndex);\n            return nextPart;\n          }\n\n          var uploadPartIndex = incUploadIndex();\n\n          if (uploadPartIndex === undefined) {\n            debug(\"No parts remaining.\", workerIndex);\n            return undefined;\n          }\n\n          debug(\"Fetching metadata for part \".concat(uploadPartIndex, \".\"), workerIndex);\n          return _await((0,upload_api_client_upload_js_namespaceObject.getUploadPart)(getConfig(), accountId, uploadMetadata.uploadId, uploadPartIndex), handleApiResult);\n        });\n\n        var bytesSentByEachWorker = [];\n\n        var uploadNextPart = function uploadNextPart(workerIndex) {\n          return _await(getNextPart(workerIndex), function (nextPart) {\n            return _invokeIgnored(function () {\n              if (nextPart !== undefined) {\n                var lastBytesSent = 0;\n\n                var progress = function progress(_ref) {\n                  var bytesSent = _ref.bytesSent;\n\n                  if (bytesSentByEachWorker[workerIndex] === undefined) {\n                    bytesSentByEachWorker[workerIndex] = bytesSent;\n                  } else {\n                    bytesSentByEachWorker[workerIndex] -= lastBytesSent;\n                    bytesSentByEachWorker[workerIndex] += bytesSent;\n                  }\n\n                  lastBytesSent = bytesSent;\n                  var totalBytesSent = bytesSentByEachWorker.reduce(function (a, b) {\n                    return a + b;\n                  });\n                  progressSmoother.setValue(totalBytesSent);\n                };\n\n                return _await(uploadPart(file, nextPart, progress, addCancellationHandler, workerIndex), function () {\n                  return Upload_awaitIgnored(uploadNextPart(workerIndex));\n                });\n              }\n            });\n          });\n        };\n\n        return _await(Promise.all(_toConsumableArray(Array(maxUploadConcurrency).keys()).map(function (workerIndex) {\n          return _await(uploadNextPart(workerIndex));\n        })), function () {\n          var uploadedFile = Object.assign({\n            accountId: accountId,\n            file: file\n          }, uploadMetadata.file);\n          debug(\"File upload completed.\");\n          return uploadedFile;\n        });\n      });\n    }));\n  });\n\n  var putUploadPart = Upload_async(function (url, content, progress, addCancellationHandler) {\n    var xhr = new XMLHttpRequest();\n    var pending = true;\n    addCancellationHandler(function () {\n      if (pending) {\n        xhr.abort();\n      }\n    });\n    return Upload_finallyRethrows(function () {\n      return _await(new Promise(function (resolve, reject) {\n        xhr.upload.addEventListener(\"progress\", function (evt) {\n          if (evt.lengthComputable) {\n            progress({\n              bytesSent: evt.loaded,\n              bytesTotal: evt.total\n            });\n          }\n        }, false);\n        xhr.addEventListener(\"load\", function () {\n          // Ensure we always report the progress of a finished upload as 100%.\n          progress({\n            bytesSent: content.size,\n            bytesTotal: content.size\n          });\n\n          if (Math.floor(xhr.status / 100) === 2) {\n            var etag = xhr.getResponseHeader(\"etag\");\n\n            if (etag === null || etag === undefined) {\n              reject(new Error(\"File upload error: no etag header in upload response.\"));\n            } else {\n              resolve({\n                etag: etag\n              });\n            }\n          } else {\n            reject(new Error(\"File upload error: status code \".concat(xhr.status)));\n          }\n        });\n\n        xhr.onabort = function () {\n          return reject(new Error(\"File upload cancelled.\"));\n        };\n\n        xhr.onerror = function () {\n          return reject(new Error(\"File upload error.\"));\n        };\n\n        xhr.ontimeout = function () {\n          return reject(new Error(\"File upload timeout.\"));\n        };\n\n        xhr.open(\"PUT\", url);\n        xhr.send(content);\n      }));\n    }, function (_wasThrown, _result) {\n      pending = false;\n      return Upload_rethrow(_wasThrown, _result);\n    });\n  });\n\n  var uploadPart = Upload_async(function (file, part, progress, addCancellationHandler, workerIndex) {\n    var content = part.range.inclusiveEnd === -1 ? new Blob() : file.slice(part.range.inclusiveStart, part.range.inclusiveEnd + 1);\n    debug(\"Uploading part \".concat(part.uploadPartIndex, \".\"), workerIndex);\n    return _await(putUploadPart(part.uploadUrl, content, progress, addCancellationHandler), function (_ref2) {\n      var etag = _ref2.etag;\n      return _await((0,upload_api_client_upload_js_namespaceObject.completeUploadPart)(getConfig(), accountId, part.uploadId, part.uploadPartIndex, {\n        etag: etag\n      }), function (_completeUploadPart) {\n        handleApiResult(_completeUploadPart);\n        debug(\"Uploaded part \".concat(part.uploadPartIndex, \".\"), workerIndex);\n      });\n    });\n  });\n\n  var withProgressReporting = Upload_async(function (tickInterval, tick, scope) {\n    var whileReportingResolved;\n    var whileReporting = new Promise(function (resolve) {\n      whileReportingResolved = resolve;\n    });\n    var isReporting = true;\n\n    var stopReporting = function stopReporting() {\n      if (isReporting) {\n        whileReportingResolved();\n        clearInterval(intervalHandle);\n        isReporting = false;\n      }\n    };\n\n    var intervalHandle = setInterval(function () {\n      return tick(stopReporting);\n    }, tickInterval);\n    return Upload_finallyRethrows(function () {\n      return Upload_call(scope, function (result) {\n        return _await(whileReporting, function () {\n          return result;\n        });\n      });\n    }, function (_wasThrown2, _result2) {\n      stopReporting();\n      return Upload_rethrow(_wasThrown2, _result2);\n    });\n  });\n\n  var deleteAccessToken = Upload_async(function () {\n    return Upload_awaitIgnored(deleteNoResponse(accessTokenPath, {}, true // Required, else CDN response's `Set-Cookie` header will be silently ignored.\n    ));\n  });\n\n  var refreshAccessToken = Upload_async(function (authUrl, authHeaders, authSession) {\n    return _continueIgnored(_catch(function () {\n      return Upload_awaitIgnored(authMutex.safe(Upload_async(function () {\n        // Session may have been ended while timer was waiting.\n        if (!authSession.isActive) {\n          return;\n        }\n\n        return Upload_call(authHeaders, function (_authHeaders) {\n          return _await(getText(authUrl, _authHeaders), function (token) {\n            return _await(putJsonGetJson(accessTokenPath, {}, {\n              accessToken: token\n            }, true // Required, else CDN response's `Set-Cookie` header will be silently ignored.\n            ), function (setTokenResult) {\n              authSession.accessToken = setTokenResult.accessToken;\n              authSession.accessTokenRefreshHandle = window.setTimeout(function () {\n                refreshAccessToken(authUrl, authHeaders, authSession).then(function () {}, function (e) {\n                  return error(\"Permanent error when refreshing access token: \".concat(e));\n                });\n              }, Math.max(0, (setTokenResult.ttlSeconds - refreshBeforeExpirySeconds) * 1000));\n            });\n          });\n        });\n      })));\n    }, function (e) {\n      // Perform attempts as part of same promise, rather than via a 'setTimeout' so that the 'beginAuthSession' only\n      // returns once an auth session has been successfully established.\n      debug(\"Error when refreshing access token: \".concat(e));\n      return _await(new Promise(function (resolve) {\n        return setTimeout(resolve, retryAuthAfterErrorSeconds * 1000);\n      }), function () {\n        // Todo: is this stack safe?\n        return Upload_awaitIgnored(refreshAccessToken(authUrl, authHeaders, authSession));\n      });\n    }));\n  });\n\n  var putJsonGetJson = Upload_async(function (url, headers, requestBody, withCredentials) {\n    return _await(nonUploadApiRequest({\n      method: \"PUT\",\n      path: url,\n      headers: headers,\n      body: requestBody\n    }, withCredentials), function (_nonUploadApiRequest) {\n      return _await(handleApiResult(_nonUploadApiRequest));\n    });\n  });\n\n  var getText = Upload_async(function (url, headers) {\n    return _await(nonUploadApiRequest({\n      method: \"GET\",\n      path: url,\n      headers: headers\n    }, false), function (_nonUploadApiRequest2) {\n      return _await(handleApiResult(_nonUploadApiRequest2));\n    });\n  });\n\n  var deleteNoResponse = Upload_async(function (url, headers, withCredentials) {\n    return _await(nonUploadApiRequest({\n      method: \"DELETE\",\n      path: url,\n      headers: headers\n    }, withCredentials), function (_nonUploadApiRequest3) {\n      handleApiResult(_nonUploadApiRequest3);\n    });\n  });\n\n  var handleApiResult = function handleApiResult(result) {\n    var _a;\n\n    if (result.ok) {\n      return result.body;\n    }\n\n    var errorResponseMaybe = result.body;\n\n    if (typeof ((_a = errorResponseMaybe === null || errorResponseMaybe === void 0 ? void 0 : errorResponseMaybe.error) === null || _a === void 0 ? void 0 : _a.code) === \"string\") {\n      throw new UploadApiError(errorResponseMaybe);\n    }\n\n    throw new Error(\"Unexpected API error.\");\n  };\n\n  var nonUploadApiRequest = Upload_async(function (options, withCredentials) {\n    return (0,upload_api_client_upload_js_namespaceObject.request)({\n      BASE: options.path,\n      WITH_CREDENTIALS: withCredentials\n    }, Object.assign(Object.assign({}, options), {\n      path: \"\" // We set to \"\" because we're using \"BASE\" above instead.\n\n    }));\n  });\n\n  var getConfig = function getConfig() {\n    var apiConfig = {\n      BASE: apiUrl,\n      WITH_CREDENTIALS: true\n    };\n\n    if (authenticateWithApiKey) {\n      apiConfig.USERNAME = \"apikey\";\n      apiConfig.PASSWORD = config.apiKey;\n    }\n\n    var accessToken = lastAuthSession === null || lastAuthSession === void 0 ? void 0 : lastAuthSession.accessToken;\n\n    if (headers !== undefined || accessToken !== undefined) {\n      apiConfig.HEADERS = Upload_async(function () {\n        return _await(headers === undefined ? {} : headers(), function (headersFromConfig) {\n          var accessToken = lastAuthSession === null || lastAuthSession === void 0 ? void 0 : lastAuthSession.accessToken; // Re-fetch as there's been an async boundary so state may have changed.\n\n          return Object.assign(Object.assign({}, headersFromConfig), accessToken === undefined ? {} : {\n            \"authorization-token\": accessToken\n          });\n        }, headers === undefined);\n      });\n    }\n\n    return apiConfig;\n  };\n\n  var normalizeMimeType = function normalizeMimeType(mime) {\n    var normal = mime.toLowerCase();\n    var regex = /^[a-z0-9]+\\/[a-z0-9+\\-._]+(?:;[^=]+=[^;]+)*$/; // Sync with 'MimeTypeUnboxed' in 'upload/api'.\n\n    return regex.test(normal) ? normal : undefined;\n  };\n\n  var debug = function debug(message, workerIndex) {\n    if (debugMode) {\n      console.log(\"\".concat(logPrefix).concat(message).concat(workerIndex !== undefined ? \" (Worker \".concat(workerIndex, \")\") : \"\"));\n    }\n  };\n\n  var error = function error(message) {\n    console.error(\"\".concat(logPrefix).concat(message));\n  };\n\n  return {\n    beginAuthSession: beginAuthSession,\n    endAuthSession: endAuthSession,\n    uploadFile: uploadFile,\n    url: url\n  };\n}\n;// CONCATENATED MODULE: ./src/index.ts\n\n\n\n/***/ })\n\n/******/ \t});\n/************************************************************************/\n/******/ \t// The module cache\n/******/ \tvar __webpack_module_cache__ = {};\n/******/ \t\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(__webpack_module_cache__[moduleId]) {\n/******/ \t\t\treturn __webpack_module_cache__[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = __webpack_module_cache__[moduleId] = {\n/******/ \t\t\t// no module.id needed\n/******/ \t\t\t// no module.loaded needed\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/ \t\n/******/ \t\t// Execute the module function\n/******/ \t\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n/******/ \t\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/ \t\n/************************************************************************/\n/******/ \t/* webpack/runtime/define property getters */\n/******/ \t!function() {\n/******/ \t\t// define getter functions for harmony exports\n/******/ \t\t__webpack_require__.d = function(exports, definition) {\n/******/ \t\t\tfor(var key in definition) {\n/******/ \t\t\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n/******/ \t\t\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n/******/ \t\t\t\t}\n/******/ \t\t\t}\n/******/ \t\t};\n/******/ \t}();\n/******/ \t\n/******/ \t/* webpack/runtime/hasOwnProperty shorthand */\n/******/ \t!function() {\n/******/ \t\t__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }\n/******/ \t}();\n/******/ \t\n/******/ \t/* webpack/runtime/make namespace object */\n/******/ \t!function() {\n/******/ \t\t// define __esModule on exports\n/******/ \t\t__webpack_require__.r = function(exports) {\n/******/ \t\t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t\t}\n/******/ \t\t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t\t};\n/******/ \t}();\n/******/ \t\n/************************************************************************/\n/******/ \t// module exports must be returned from runtime so entry inlining is disabled\n/******/ \t// startup\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(\"./src/index.ts\");\n/******/ })()\n;"],"names":["module","__webpack_modules__","__unused_webpack_module","__webpack_exports__","__webpack_require__","Upload","UploadApiError","upload_api_client_upload_js_namespaceObject","require$$0","_call","body","then","direct","result","e","_rethrow","thrown","value","_finallyRethrows","finalizer","_empty","_awaitIgnored","_settle","pact","state","_Pact","observer","onFulfilled","onRejected","callback","_this","_isSettledPact","thenable","_for","test","update","stage","shouldContinue","updateValue","reject","_resumeAfterTest","_resumeAfterBody","_resumeAfterUpdate","_continue","_async","f","args","i","Mutex","mutex","resolver","safe","acquire","_wasThrown","_result","release","resolve","external_progress_smoother_namespaceObject","require$$1","_typeof","obj","_defineProperties","target","props","descriptor","_createClass","Constructor","protoProps","staticProps","_classCallCheck","instance","_inherits","subClass","superClass","_setPrototypeOf","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","Super","_getPrototypeOf","NewTarget","_possibleConstructorReturn","self","call","_assertThisInitialized","_wrapNativeSuper","Class","_cache","_isNativeFunction","Wrapper","_construct","Parent","a","fn","o","p","_Error","_super","response","Upload_rethrow","Upload_finallyRethrows","_continueIgnored","Upload_empty","_toConsumableArray","arr","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","minLen","_arrayLikeToArray","n","iter","len","arr2","accountIdLength","Upload_awaitIgnored","specialApiKeyAccountId","Upload_call","specialApiKeys","Upload_async","apiKeyPrefix","_callIgnored","maxUploadConcurrency","_await","refreshBeforeExpirySeconds","_catch","recover","onProgressInterval","_invokeIgnored","retryAuthAfterErrorSeconds","accessTokenPathBase","logPrefix","config","_a","_b","_c","_d","_e","_f","_g","_h","_j","accountId","authMutex","apiUrl","cdnUrl","authenticateWithApiKey","headers","debugMode","lastAuthSession","accessTokenPath","beginAuthSession","authUrl","authHeaders","endAuthSession","authSession","refreshAccessToken","deleteAccessToken","uploadFile","file","params","cancellationHandlers","addCancellationHandler","ca","cancel","x","beginFileUpload","url","filePath","slugOrParams","defaultSlug","progressSmoother","reportProgress","stopReportingProgress","bytesSent","bytesTotal","withProgressReporting","uploadRequest","normalizeMimeType","debug","getConfig","_beginMultipartUpload","uploadMetadata","handleApiResult","incUploadIndex","lastUploadIndex","nextPartQueue","getNextPart","workerIndex","nextPart","uploadPartIndex","bytesSentByEachWorker","uploadNextPart","lastBytesSent","progress","_ref","totalBytesSent","b","uploadPart","uploadedFile","putUploadPart","content","xhr","pending","evt","etag","part","_ref2","_completeUploadPart","tickInterval","tick","scope","whileReportingResolved","whileReporting","isReporting","stopReporting","intervalHandle","_wasThrown2","_result2","deleteNoResponse","_authHeaders","getText","token","putJsonGetJson","setTokenResult","error","requestBody","withCredentials","nonUploadApiRequest","_nonUploadApiRequest","_nonUploadApiRequest2","_nonUploadApiRequest3","errorResponseMaybe","options","apiConfig","accessToken","headersFromConfig","mime","normal","regex","message","__webpack_module_cache__","moduleId","exports","definition","key","prop"],"mappings":"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"}
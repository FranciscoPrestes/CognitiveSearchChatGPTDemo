import{r as _n}from"./@upload-io-528e2b93.js";import{r as bn}from"./progress-smoother-d5015ad4.js";var he={},Pn={get exports(){return he},set exports($){he=$}};(function($){$.exports=function(){var ye={"./src/index.ts":function(P,A,x){x.r(A),x.d(A,{Upload:function(){return Xe},UploadApiError:function(){return ae}});var q=_n();function me(e,n,r){if(r)return n?n(e()):e();try{var t=Promise.resolve(e());return n?t.then(n):t}catch(i){return Promise.reject(i)}}function ge(e,n){if(e)throw n;return n}function _e(e,n){try{var r=e()}catch(t){return n(!0,t)}return r&&r.then?r.then(n.bind(null,!1),n.bind(null,!0)):n(!1,r)}function be(){}function Pe(e,n){if(!n)return e&&e.then?e.then(be):Promise.resolve()}function w(e,n,r){if(!e.s){if(r instanceof Q)if(r.s)n&1&&(n=r.s),r=r.v;else{r.o=w.bind(null,e,n);return}if(r&&r.then){r.then(w.bind(null,e,n),w.bind(null,e,2));return}e.s=n,e.v=r;var t=e.o;t&&t(e)}}var Q=function(){function e(){}return e.prototype.then=function(n,r){var t=new e,i=this.s;if(i){var c=i&1?n:r;if(c){try{w(t,1,c(this.v))}catch(l){w(t,2,l)}return t}else return this}return this.o=function(l){try{var y=l.v;l.s&1?w(t,1,n?n(y):y):r?w(t,1,r(y)):w(t,2,y)}catch(_){w(t,2,_)}},t},e}();function k(e){return e instanceof Q&&e.s&1}function we(e,n,r){for(var t;;){var i=e();if(k(i)&&(i=i.v),!i)return c;if(i.then){t=0;break}var c=r();if(c&&c.then)if(k(c))c=c.s;else{t=1;break}if(n){var l=n();if(l&&l.then&&!k(l)){t=2;break}}}var y=new Q,_=w.bind(null,y,2);return(t===0?i.then(b):t===1?c.then(E):l.then(B)).then(void 0,_),y;function E(H){c=H;do{if(n&&(l=n(),l&&l.then&&!k(l))){l.then(B).then(void 0,_);return}if(i=e(),!i||k(i)&&!i.v){w(y,1,c);return}if(i.then){i.then(b).then(void 0,_);return}c=r(),k(c)&&(c=c.v)}while(!c||!c.then);c.then(E).then(void 0,_)}function b(H){H?(c=r(),c&&c.then?c.then(E).then(void 0,_):E(c)):w(y,1,c)}function B(){(i=e())?i.then?i.then(b).then(void 0,_):b(i):w(y,1,c)}}function Ae(e,n){return e&&e.then?e.then(n):n(e)}function Se(e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];try{return Promise.resolve(e.apply(this,n))}catch(t){return Promise.reject(t)}}}function Ee(){var e,n,r=function(l){return me(t,function(){return _e(l,function(y,_){return i(),ge(y,_)})})},t=Se(function(){return Ae(we(function(){return e!==void 0},void 0,function(){return Pe(e)}),function(){e=new Promise(function(c){n=c})})}),i=function(){if(n===void 0)throw new Error("Unable to release mutex: already released.");n(),n=void 0,e=void 0};return{safe:r}}var Te=bn();function X(e){return X=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},X(e)}function oe(e,n){for(var r=0;r<n.length;r++){var t=n[r];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function Oe(e,n,r){return n&&oe(e.prototype,n),r&&oe(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Re(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function Ue(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&K(e,n)}function Ie(e){var n=ie();return function(){var t=F(e),i;if(n){var c=F(this).constructor;i=Reflect.construct(t,arguments,c)}else i=t.apply(this,arguments);return xe(this,i)}}function xe(e,n){if(n&&(X(n)==="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ke(e)}function ke(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Y(e){var n=typeof Map=="function"?new Map:void 0;return Y=function(t){if(t===null||!je(t))return t;if(typeof t!="function")throw new TypeError("Super expression must either be null or a function");if(typeof n<"u"){if(n.has(t))return n.get(t);n.set(t,i)}function i(){return D(t,arguments,F(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),K(i,t)},Y(e)}function D(e,n,r){return ie()?D=Reflect.construct:D=function(i,c,l){var y=[null];y.push.apply(y,c);var _=Function.bind.apply(i,y),E=new _;return l&&K(E,l.prototype),E},D.apply(null,arguments)}function ie(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function je(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function K(e,n){return K=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t},K(e,n)}function F(e){return F=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},F(e)}var ae=function(e){Ue(r,e);var n=Ie(r);function r(t){var i;return Re(this,r),i=n.call(this,t.error.message),i.errorCode=t.error.code,i.details=t.error.details,i}return Oe(r)}(Y(Error));function ue(e,n){if(e)throw n;return n}function ce(e,n){try{var r=e()}catch(t){return n(!0,t)}return r&&r.then?r.then(n.bind(null,!1),n.bind(null,!0)):n(!1,r)}function Me(e){if(e&&e.then)return e.then(L)}function Ne(e){return He(e)||Be(e)||Fe(e)||Ke()}function Ke(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Fe(e,n){if(e){if(typeof e=="string")return Z(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Z(e,n)}}function Be(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function He(e){if(Array.isArray(e))return Z(e)}function Z(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}function L(){}var fe=7;function j(e,n){if(!n)return e&&e.then?e.then(L):Promise.resolve()}var We="W142hJk";function z(e,n,r){if(r)return n?n(e()):e();try{var t=Promise.resolve(e());return n?t.then(n):t}catch(i){return Promise.reject(i)}}var qe=["free","demo"];function g(e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];try{return Promise.resolve(e.apply(this,n))}catch(t){return Promise.reject(t)}}}var V="public_";function De(e,n){return z(e,L,n)}var Le=5;function h(e,n,r){return r?n?n(e):e:((!e||!e.then)&&(e=Promise.resolve(e)),n?e.then(n):e)}var ze=20;function se(e,n){try{var r=e()}catch(t){return n(t)}return r&&r.then?r.then(void 0,n):r}var Je=100;function $e(e){var n=e();if(n&&n.then)return n.then(L)}var Ge=5,Qe="/api/v1/access_tokens/",U="[upload-js] ";function Xe(e){var n,r,t,i,c,l,y,_,E,b,B=Ee(),H=(r=(n=e.internal)===null||n===void 0?void 0:n.apiUrl)!==null&&r!==void 0?r:"https://api.upload.io",de=(i=(t=e.internal)===null||t===void 0?void 0:t.cdnUrl)!==null&&i!==void 0?i:"https://upcdn.io",Ye=(l=(c=e.internal)===null||c===void 0?void 0:c.authenticateWithApiKey)!==null&&l!==void 0?l:!0,J=(y=e.internal)===null||y===void 0?void 0:y.headers,Ze=e.debug===!0,O;if((e??void 0)===void 0)throw new Error("".concat(U,"Config parameter required."));if(e.debug===!0&&console.log("".concat(U,"Initialized with API key '").concat(e.apiKey,"'")),((_=e.apiKey)!==null&&_!==void 0?_:void 0)===void 0)throw new Error("".concat(U,"Please provide an API key via the 'apiKey' config parameter."));if(e.apiKey.trim()!==e.apiKey)throw new Error("".concat(U,"API key needs trimming (whitespace detected)."));if(((E=e.internal)===null||E===void 0?void 0:E.authenticateWithApiKey)===!1)b=e.internal.accountId;else if(qe.includes(e.apiKey))b=We;else{if(!e.apiKey.startsWith(V))throw new Error("".concat(U,'API key must begin with "').concat(V,'".'));if(b=e.apiKey.substr(V.length,fe),b.length!==fe)throw new Error("".concat(U,"API key is too short!"))}var le="".concat(de).concat(Qe).concat(b),Ve=function(o,a){return z(pe,function(){var f={accessToken:void 0,accessTokenRefreshHandle:void 0,isActive:!0};return O=f,j(C(o,a,f))})},pe=g(function(){return j(B.safe(g(function(){if(O!==void 0){var u=O;return O=void 0,u.accessTokenRefreshHandle!==void 0&&clearTimeout(u.accessTokenRefreshHandle),u.isActive=!1,De(an)}})))}),Ce=g(function(u){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=[],f=function(m){a.push(m)},s=function(){return a.forEach(function(m){return m()})};return o.onBegin!==void 0&&o.onBegin({cancel:s}),se(function(){return h(nn(u,o,f))},function(d){throw s(),d})}),en=function(o,a){var f,s="raw",d=typeof a=="string"?{transformation:a}:a;return"".concat(de,"/").concat(b,"/").concat((f=d==null?void 0:d.transformation)!==null&&f!==void 0?f:s).concat(o).concat((d==null?void 0:d.auth)===!0?"?_auth=true":"")},nn=g(function(u,o,a){var f=(0,Te.ProgressSmoother)({maxValue:u.size,teardownTime:1e3,minDelayUntilFirstValue:2e3,valueIncreaseDelta:204800,valueIncreaseRatePerSecond:51200,averageTimeBetweenValues:1e3}),s=function(m){if(o.onProgress===void 0)m();else{var v=f.smoothedValue(),p=u.size;v===p&&m(),o.onProgress({bytesSent:v,bytesTotal:p,progress:Math.round(v/p*100)})}};return on(Je,s,g(function(){var d={path:o.path,metadata:o.metadata,mime:sn(u.type),originalFileName:u.name,protocol:"1.1",size:u.size,tags:o.tags};return R("Initiating file upload. Params = ".concat(JSON.stringify(d))),h((0,q.beginMultipartUpload)(ne(),b,d),function(m){var v=M(m);R("Initiated file upload. Metadata = ".concat(JSON.stringify(v)));var p=function(){var S=0;return function(){if(S!==v.uploadParts.count-1)return++S}}(),re=[v.uploadParts.first],ln=g(function(S){var T=re.pop();if(T!==void 0)return R("Dequeued part ".concat(T.uploadPartIndex,"."),S),T;var N=p();if(N===void 0){R("No parts remaining.",S);return}return R("Fetching metadata for part ".concat(N,"."),S),h((0,q.getUploadPart)(ne(),b,v.uploadId,N),M)}),W=[],pn=function S(T){return h(ln(T),function(N){return $e(function(){if(N!==void 0){var ve=0,vn=function(hn){var te=hn.bytesSent;W[T]===void 0?W[T]=te:(W[T]-=ve,W[T]+=te),ve=te;var yn=W.reduce(function(mn,gn){return mn+gn});f.setValue(yn)};return h(tn(u,N,vn,a,T),function(){return j(S(T))})}})})};return h(Promise.all(Ne(Array(Le).keys()).map(function(S){return h(pn(S))})),function(){var S=Object.assign({accountId:b,file:u},v.file);return R("File upload completed."),S})})}))}),rn=g(function(u,o,a,f){var s=new XMLHttpRequest,d=!0;return f(function(){d&&s.abort()}),ce(function(){return h(new Promise(function(m,v){s.upload.addEventListener("progress",function(p){p.lengthComputable&&a({bytesSent:p.loaded,bytesTotal:p.total})},!1),s.addEventListener("load",function(){if(a({bytesSent:o.size,bytesTotal:o.size}),Math.floor(s.status/100)===2){var p=s.getResponseHeader("etag");p==null?v(new Error("File upload error: no etag header in upload response.")):m({etag:p})}else v(new Error("File upload error: status code ".concat(s.status)))}),s.onabort=function(){return v(new Error("File upload cancelled."))},s.onerror=function(){return v(new Error("File upload error."))},s.ontimeout=function(){return v(new Error("File upload timeout."))},s.open("PUT",u),s.send(o)}))},function(m,v){return d=!1,ue(m,v)})}),tn=g(function(u,o,a,f,s){var d=o.range.inclusiveEnd===-1?new Blob:u.slice(o.range.inclusiveStart,o.range.inclusiveEnd+1);return R("Uploading part ".concat(o.uploadPartIndex,"."),s),h(rn(o.uploadUrl,d,a,f),function(m){var v=m.etag;return h((0,q.completeUploadPart)(ne(),b,o.uploadId,o.uploadPartIndex,{etag:v}),function(p){M(p),R("Uploaded part ".concat(o.uploadPartIndex,"."),s)})})}),on=g(function(u,o,a){var f,s=new Promise(function(p){f=p}),d=!0,m=function(){d&&(f(),clearInterval(v),d=!1)},v=setInterval(function(){return o(m)},u);return ce(function(){return z(a,function(p){return h(s,function(){return p})})},function(p,re){return m(),ue(p,re)})}),an=g(function(){return j(fn(le,{},!0))}),C=g(function(u,o,a){return Me(se(function(){return j(B.safe(g(function(){if(a.isActive)return z(o,function(f){return h(cn(u,f),function(s){return h(un(le,{},{accessToken:s},!0),function(d){a.accessToken=d.accessToken,a.accessTokenRefreshHandle=window.setTimeout(function(){C(u,o,a).then(function(){},function(m){return dn("Permanent error when refreshing access token: ".concat(m))})},Math.max(0,(d.ttlSeconds-ze)*1e3))})})})})))},function(f){return R("Error when refreshing access token: ".concat(f)),h(new Promise(function(s){return setTimeout(s,Ge*1e3)}),function(){return j(C(u,o,a))})}))}),un=g(function(u,o,a,f){return h(ee({method:"PUT",path:u,headers:o,body:a},f),function(s){return h(M(s))})}),cn=g(function(u,o){return h(ee({method:"GET",path:u,headers:o},!1),function(a){return h(M(a))})}),fn=g(function(u,o,a){return h(ee({method:"DELETE",path:u,headers:o},a),function(f){M(f)})}),M=function(o){var a;if(o.ok)return o.body;var f=o.body;throw typeof((a=f==null?void 0:f.error)===null||a===void 0?void 0:a.code)=="string"?new ae(f):new Error("Unexpected API error.")},ee=g(function(u,o){return(0,q.request)({BASE:u.path,WITH_CREDENTIALS:o},Object.assign(Object.assign({},u),{path:""}))}),ne=function(){var o={BASE:H,WITH_CREDENTIALS:!0};Ye&&(o.USERNAME="apikey",o.PASSWORD=e.apiKey);var a=O==null?void 0:O.accessToken;return(J!==void 0||a!==void 0)&&(o.HEADERS=g(function(){return h(J===void 0?{}:J(),function(f){var s=O==null?void 0:O.accessToken;return Object.assign(Object.assign({},f),s===void 0?{}:{"authorization-token":s})},J===void 0)})),o},sn=function(o){var a=o.toLowerCase(),f=/^[a-z0-9]+\/[a-z0-9+\-._]+(?:;[^=]+=[^;]+)*$/;return f.test(a)?a:void 0},R=function(o,a){Ze&&console.log("".concat(U).concat(o).concat(a!==void 0?" (Worker ".concat(a,")"):""))},dn=function(o){console.error("".concat(U).concat(o))};return{beginAuthSession:Ve,endAuthSession:pe,uploadFile:Ce,url:en}}}},G={};function I(P){if(G[P])return G[P].exports;var A=G[P]={exports:{}};return ye[P](A,A.exports,I),A.exports}return function(){I.d=function(P,A){for(var x in A)I.o(A,x)&&!I.o(P,x)&&Object.defineProperty(P,x,{enumerable:!0,get:A[x]})}}(),function(){I.o=function(P,A){return Object.prototype.hasOwnProperty.call(P,A)}}(),function(){I.r=function(P){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(P,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(P,"__esModule",{value:!0})}}(),I("./src/index.ts")}()})(Pn);export{he as m};
//# sourceMappingURL=upload-js-e5d126b1.js.map

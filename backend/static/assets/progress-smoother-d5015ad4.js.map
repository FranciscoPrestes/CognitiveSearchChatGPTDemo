{"version":3,"file":"progress-smoother-d5015ad4.js","sources":["../../../frontend/node_modules/progress-smoother/dist/main.js"],"sourcesContent":["module.exports =\n/******/ (function() { // webpackBootstrap\n/******/ \t\"use strict\";\n/******/ \tvar __webpack_modules__ = ({\n\n/***/ \"./src/index.ts\":\n/***/ (function(__unused_webpack_module, __webpack_exports__, __webpack_require__) {\n\n// ESM COMPAT FLAG\n__webpack_require__.r(__webpack_exports__);\n\n// EXPORTS\n__webpack_require__.d(__webpack_exports__, {\n  \"ProgressSmoother\": function() { return /* reexport */ ProgressSmoother; }\n});\n\n;// CONCATENATED MODULE: ./src/ProgressSmoother.ts\nfunction ProgressSmoother(config) {\n  var _a, _b;\n\n  var minFinishDuration = 1000; // If set to 0, the download with abruptly move to 100% on the final chunk. This way it smooths over 1000ms.\n\n  var maxForecastFactor = 0.33; // How much to estimate without receiving a single chunk.\n\n  var minSetupTime = (_a = config.minDelayUntilFirstValue) !== null && _a !== void 0 ? _a : 0;\n  var minTeardownTime = (_b = config.teardownTime) !== null && _b !== void 0 ? _b : 0;\n  var valueIncreaseRatePerSecond = config.valueIncreaseRatePerSecond,\n      averageTimeBetweenValues = config.averageTimeBetweenValues,\n      maxValue = config.maxValue,\n      valueIncreaseDelta = config.valueIncreaseDelta;\n\n  var _lastReading;\n\n  var lastTimeMinus1 = Date.now();\n  var lastYieldedValue = 0;\n  var movingAverage = 0;\n\n  function returnMonotonic(getValue) {\n    var value = getValue();\n\n    if (value > lastYieldedValue) {\n      lastYieldedValue = value;\n    }\n\n    return lastYieldedValue;\n  }\n\n  function hasFinished(lastReading) {\n    return lastReading.value === maxValue;\n  }\n\n  function fromLastReading(lastReading, now) {\n    if (hasFinished(lastReading)) {\n      var teardownTime = Math.max(minFinishDuration, minTeardownTime);\n      var millisElapsed = now - lastReading.time;\n      var percentageIntoTeardown = millisElapsed / teardownTime;\n      var percentageIntoTeardownCapped = Math.min(1, percentageIntoTeardown);\n      var percentageIntoTeardownEased = easeInQuad(percentageIntoTeardownCapped);\n      var delta = lastReading.value - movingAverage;\n      return movingAverage + delta * percentageIntoTeardownEased;\n    }\n\n    return calculateEMA(lastReading.value, now, lastTimeMinus1);\n  }\n\n  function forecastInitialValue(now) {\n    var maxForecastSize = Math.min(valueIncreaseDelta, maxValue * maxForecastFactor);\n    var maxForecastTransferTime = maxForecastSize / valueIncreaseRatePerSecond * 1000;\n    var maxTwiddleTime = minSetupTime + maxForecastTransferTime;\n    var millisElapsed = now - lastTimeMinus1;\n    var percentageIntoTwiddleTime = millisElapsed / maxTwiddleTime;\n    var percentageIntoTwiddleTimeCapped = Math.min(1, percentageIntoTwiddleTime);\n    return percentageIntoTwiddleTimeCapped * maxForecastSize;\n  }\n\n  function alpha(now, lastTime) {\n    var alphaMagicNumber = 3.5; // This just seems to work best, from playing around.\n\n    return 1 - Math.exp(-(now - lastTime) / (averageTimeBetweenValues * alphaMagicNumber));\n  }\n\n  function calculateEMA(value, now, lastTime) {\n    var a = alpha(now, lastTime);\n    return a * value + (1 - a) * movingAverage;\n  }\n\n  function easeInQuad(x) {\n    return x * x;\n  }\n\n  function setValue(value, nowMaybe) {\n    if (_lastReading !== undefined) {\n      if (hasFinished(_lastReading)) {\n        return;\n      }\n\n      movingAverage = calculateEMA(_lastReading.value, _lastReading.time, lastTimeMinus1);\n      lastTimeMinus1 = _lastReading.time;\n    }\n\n    _lastReading = {\n      time: nowMaybe !== null && nowMaybe !== void 0 ? nowMaybe : Date.now(),\n      value: Math.min(value, maxValue)\n    };\n  }\n\n  function smoothedValue(nowMaybe) {\n    return returnMonotonic(function () {\n      var now = nowMaybe !== null && nowMaybe !== void 0 ? nowMaybe : Date.now();\n\n      if (_lastReading !== undefined) {\n        return fromLastReading(_lastReading, now);\n      }\n\n      return forecastInitialValue(now);\n    });\n  }\n\n  function smoothedFactor(nowMaybe) {\n    return smoothedValue(nowMaybe) / maxValue;\n  }\n\n  return {\n    setValue: setValue,\n    smoothedValue: smoothedValue,\n    smoothedFactor: smoothedFactor\n  };\n}\n;// CONCATENATED MODULE: ./src/index.ts\n\n\n/***/ })\n\n/******/ \t});\n/************************************************************************/\n/******/ \t// The module cache\n/******/ \tvar __webpack_module_cache__ = {};\n/******/ \t\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(__webpack_module_cache__[moduleId]) {\n/******/ \t\t\treturn __webpack_module_cache__[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = __webpack_module_cache__[moduleId] = {\n/******/ \t\t\t// no module.id needed\n/******/ \t\t\t// no module.loaded needed\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/ \t\n/******/ \t\t// Execute the module function\n/******/ \t\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n/******/ \t\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/ \t\n/************************************************************************/\n/******/ \t/* webpack/runtime/define property getters */\n/******/ \t!function() {\n/******/ \t\t// define getter functions for harmony exports\n/******/ \t\t__webpack_require__.d = function(exports, definition) {\n/******/ \t\t\tfor(var key in definition) {\n/******/ \t\t\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n/******/ \t\t\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n/******/ \t\t\t\t}\n/******/ \t\t\t}\n/******/ \t\t};\n/******/ \t}();\n/******/ \t\n/******/ \t/* webpack/runtime/hasOwnProperty shorthand */\n/******/ \t!function() {\n/******/ \t\t__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }\n/******/ \t}();\n/******/ \t\n/******/ \t/* webpack/runtime/make namespace object */\n/******/ \t!function() {\n/******/ \t\t// define __esModule on exports\n/******/ \t\t__webpack_require__.r = function(exports) {\n/******/ \t\t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n/******/ \t\t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n/******/ \t\t\t}\n/******/ \t\t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t\t};\n/******/ \t}();\n/******/ \t\n/************************************************************************/\n/******/ \t// module exports must be returned from runtime so entry inlining is disabled\n/******/ \t// startup\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(\"./src/index.ts\");\n/******/ })()\n;"],"names":["module","__webpack_modules__","__unused_webpack_module","__webpack_exports__","__webpack_require__","ProgressSmoother","config","_a","_b","minFinishDuration","maxForecastFactor","minSetupTime","minTeardownTime","valueIncreaseRatePerSecond","averageTimeBetweenValues","maxValue","valueIncreaseDelta","_lastReading","lastTimeMinus1","lastYieldedValue","movingAverage","returnMonotonic","getValue","value","hasFinished","lastReading","fromLastReading","now","teardownTime","millisElapsed","percentageIntoTeardown","percentageIntoTeardownCapped","percentageIntoTeardownEased","easeInQuad","delta","calculateEMA","forecastInitialValue","maxForecastSize","maxForecastTransferTime","maxTwiddleTime","percentageIntoTwiddleTime","percentageIntoTwiddleTimeCapped","alpha","lastTime","alphaMagicNumber","a","x","setValue","nowMaybe","smoothedValue","smoothedFactor","__webpack_module_cache__","moduleId","exports","definition","key","obj","prop"],"mappings":"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"}